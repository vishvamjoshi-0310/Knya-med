<link rel="stylesheet" href="{{ 'main-account-page-stylesheet.css' | asset_url }}">
{{ 'intlTelInput.min.css' | asset_url | stylesheet_tag }}
<script src="{{ 'my-profile.js' | asset_url }}" defer></script>
<script src="https://cdn.jsdelivr.net/npm/intl-tel-input@18.1.1/build/js/intlTelInput.min.js"></script>

<style>
  {% if template.name == "account" %}
    .top-mail, footer{
      display: none;
    }
  {% endif %}
</style>

<div class="main-account-page">
  <!-- Profile Header Container -->
  <div class="profile-header-container">
    <div class="profile-section">
      <h1 class="profile-title">Profile</h1>
      <!-- Breadcrumbs -->
      <div class="profile-breadcrumbs desktop-profile-image">
        <a href="/">Home</a>
        <span class="separator">/</span>
        <span class="current profile-breadcrumb-desk" onclick="desktopBred()">Profile</span>
        <span class="separator desk-separator">/</span>
        <span class="current desk-orders">Orders</span>
      </div>
      <div class="profile-breadcrumbs mobile-profile-image">
        <a href="/">Home</a>
        <span class="separator">/</span>
        <span class="current profile-breadcrumb-mob" onclick="MobileBred()">Profile</span>
        <span class="separator mob-separator">/</span>
        <span class="current mob-orders">Orders</span>
      </div>
    </div>
    <div class="my-orders-toggle" onclick="MobileBred('my-orders')" style="display: none;">
      <svg width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M10.0002 4.9699C9.74018 4.7099 9.32018 4.7099 9.06018 4.9699L6.00018 8.0299C5.74018 8.2899 5.74018 8.7099 6.00018 8.9699L9.06018 12.0299C9.32018 12.2899 9.74018 12.2899 10.0002 12.0299C10.2602 11.7699 10.2602 11.3499 10.0002 11.0899L7.41351 8.49657L10.0002 5.9099C10.2602 5.6499 10.2535 5.22324 10.0002 4.9699Z" fill="#462D8C"/>
      </svg>
      My Orders
    </div>

    <!-- Profile Title -->

    <!-- Update your profile-info to be clickable -->
    <div class="profile-info" onclick="showMyProfile()">
      <div class="profile-svg-divider">
        <div class="profile-avatar">
          {% if section.settings.user_profile_image %}
            {{
              section.settings.user_profile_image
              | image_url: width: 56
              | image_tag: widths: '40, 56', loading: 'lazy', height: '56px', class: 'desktop-profile-image'
            }}
          {% endif %}
          {% if section.settings.user_profile_image_mobile %}
            {{
              section.settings.user_profile_image_mobile
              | image_url: width: 56
              | image_tag: widths: '40, 56', loading: 'lazy', height: '56px', class: 'mobile-profile-image'
            }}
          {% endif %}
        </div>
        <div class="profile-details">
          <h2 class="profile-name">
            {{ customer.first_name }}
            {{ customer.last_name }}
          </h2>
          <p class="profile-email">{{ customer.email }}</p>
        </div>
      </div>
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M9.00002 15.8751L12.88 11.9951L9.00002 8.1151C8.61002 7.7251 8.61002 7.0951 9.00002 6.7051C9.39002 6.3151 10.02 6.3151 10.41 6.7051L15 11.2951C15.39 11.6851 15.39 12.3151 15 12.7051L10.41 17.2951C10.02 17.6851 9.39002 17.6851 9.00002 17.2951C8.62002 16.9051 8.61002 16.2651 9.00002 15.8751Z" fill="black"/>
      </svg>
    </div>
    <div class="my-profile-back" onclick="MobileBred()" style="display: none;">
      <svg width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M10.0002 4.9699C9.74018 4.7099 9.32018 4.7099 9.06018 4.9699L6.00018 8.0299C5.74018 8.2899 5.74018 8.7099 6.00018 8.9699L9.06018 12.0299C9.32018 12.2899 9.74018 12.2899 10.0002 12.0299C10.2602 11.7699 10.2602 11.3499 10.0002 11.0899L7.41351 8.49657L10.0002 5.9099C10.2602 5.6499 10.2535 5.22324 10.0002 4.9699Z" fill="#462D8C"/>
      </svg>
      My Profile
    </div>
  </div>

  <!-- Account Navigation Container -->
  <div class="account-navigation-container">
    <div class="account-sidebar ">
      <ul class="account-menu">
        <li class="menu-item identify-orders active" data-tab="my-orders">
          <div class="desktop-list">
            <span class="title-my-orders">My Orders</span>
            {% if customer.orders_count >= 1 %}
              <div class="show-all-container">
                <span class="show-all-btn">Show all</span>
                <svg class="menu-arrow" width="24" height="24" viewBox="0 0 24 24" fill="none">
                  <path d="M9 18L15 12L9 6" stroke="" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </div>
            {% else %}
              <svg class="menu-arrow" width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M9 18L15 12L9 6" stroke="#2C2C2C" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            {% endif %}
          </div>

          <div class="mobile-views">
            {% if customer.orders_count < 1 %}
              <div class="orders-header">
                <h2 class="empty-title-desk">My Orders</h2>
              </div>
              <div class="empty-orders">
                {{
                  section.settings.empty_orders_image
                  | image_url: width: 244
                  | image_tag: widths: '244', loading: 'lazy', height: '203px', class: 'image-print'
                }}
                <div class="empty-cart-datails">
                  <div class="empty-cart-text">
                    <p class="empty-title empty-title-desk">Your online cart is waiting</p>
                    <p class="empty-subtitle empty-title-desk">Shop now and track your orders right here.</p>

                    <p class="empty-title empty-title-mob">Did you shop at our store?</p>
                    <p class="empty-subtitle empty-title-mob">
                      Your past purchases from our stores <br>
                      will appear in this section.
                    </p>
                  </div>
                  <a href="{{section.settings.empty_shopnow_link}}" class="empty-title-desk">Shop Now</a>
                  <a href="{{section.settings.empty_shopnow_link}}" class="empty-title-mob">Find Nearby Store</a>
                </div>
              </div>
            {% else %}
              <ul class="mobile-view-slide-mobile">
                {% for order in customer.orders %}
                  <li class="order-slide-mobile" data-order-id="{{ order.id }}">
                    <p class="order-state-number-mobile">
                      {% if order.fulfillment_status == 'fulfilled' %}
                        <span class="order-status" style="color: var(--color-spring-green-35, rgba(22, 155, 64, 1));"
                          >Your Order is Fulfilled</span
                        >
                      {% else %}
                        <span class="order-status"> Your Order is Unfulfilled </span>
                      {% endif %}
                      <span class="order-number">Order ID {{ order.name }}</span>
                    </p>

                    <div class="order-detail-container-mobile">
                      {{
                        order.line_items[0].image
                        | image_url: width: 260
                        | image_tag: widths: '150, 260', loading: 'lazy', height: '150px', class: ''
                      }}
                      <div class="order-contents-mobile">
                        <div>
                          <p class="order-product-title-mobile">{{ order.line_items[0].title }}</p>
                          {% if order.line_items.size >= 2 %}
                            <p class="order-counts-mobile">+ {{ order.line_items.size | minus: 1 }} more</p>
                          {% endif %}
                        </div>

                        {% if order.cancelled %}
                        {% elsif order.fulfillment_status == 'fulfilled' %}
                          <p class="order-slide-btn-mobile">
                            <svg
                              width="21"
                              height="22"
                              viewBox="0 0 21 22"
                              fill="none"
                              xmlns="http://www.w3.org/2000/svg"
                            >
                              <path d="M17.5 2.25H3.5C2.5375 2.25 1.75 3.0375 1.75 4V19.75L5.25 16.25H17.5C18.4625 16.25 19.25 15.4625 19.25 14.5V4C19.25 3.0375 18.4625 2.25 17.5 2.25ZM17.5 14.5H4.52375L3.5 15.5238V4H17.5V14.5Z" fill="#462D8C"/>
                              <path d="M10.5 13.625L11.8737 10.6237L14.875 9.25L11.8737 7.87625L10.5 4.875L9.12625 7.87625L6.125 9.25L9.12625 10.6237L10.5 13.625Z" fill="#462D8C"/>
                            </svg>
                            Write a Review
                          </p>
                        {% else %}
                          <a href="{{ section.settings.track_order_link }}" class="order-slide-btn-mobile">
                            <svg
                              class="menu-item-svg"
                              width="21"
                              height="22"
                              viewBox="0 0 21 22"
                              fill="none"
                              xmlns="http://www.w3.org/2000/svg"
                            >
                              <path d="M15.2909 17.7207C14.2978 18.4287 13.1437 18.9229 11.8925 19.1338V18.3662C12.9401 18.1723 13.9065 17.7581 14.7518 17.1777L15.2909 17.7207ZM9.1073 3.6377C5.64575 4.30607 3.02634 7.35287 3.02625 11C3.02625 14.6471 5.64581 17.6928 9.1073 18.3613V19.1289C5.22703 18.4518 2.27625 15.0653 2.27625 11C2.27634 6.93468 5.22698 3.54708 9.1073 2.87012V3.6377ZM18.6512 12.375C18.4403 13.6263 17.9461 14.7803 17.2382 15.7734L16.6952 15.2344C17.2756 14.389 17.6908 13.4228 17.8846 12.375H18.6512ZM10.4999 7.125C12.0768 7.125 13.4999 8.32558 13.4999 10.2129C13.4998 10.8048 13.2616 11.5017 12.7118 12.3135C12.2161 13.0453 11.4829 13.8446 10.4999 14.7119C9.51686 13.8446 8.7836 13.0453 8.28796 12.3135C7.73816 11.5017 7.49993 10.8048 7.49988 10.2129C7.49988 8.32563 8.92301 7.12506 10.4999 7.125ZM10.4999 8.62793C9.7077 8.62799 9.06361 9.27134 9.06335 10.0635C9.06335 10.8558 9.70754 11.4999 10.4999 11.5C11.2923 11.5 11.9364 10.8559 11.9364 10.0635C11.9361 9.2713 11.2921 8.62793 10.4999 8.62793ZM17.2391 6.22754C17.9467 7.2204 18.4404 8.37424 18.6512 9.625H17.8846C17.6908 8.57791 17.276 7.61205 16.6952 6.77148L17.2391 6.22754ZM11.8925 2.86523C13.139 3.07637 14.2964 3.57208 15.2899 4.2793L14.7518 4.82227C13.9065 4.24193 12.9401 3.82769 11.8925 3.63379V2.86523Z" stroke=""/>
                            </svg>
                            Track Order
                          </a>
                        {% endif %}
                      </div>
                    </div>
                  </li>
                {% endfor %}
              </ul>
            {% endif %}
          </div>
        </li>

        <li class="menu-item address-aside" data-tab="my-address">
          <div class="desktop-list">
            <span class="title-my-orders">Saved Addresses</span>
            <svg class="menu-arrow" width="24" height="24" viewBox="0 0 24 24" fill="none">
              <path d="M9 18L15 12L9 6" stroke="#2C2C2C" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
        </li>

        <li class="logout" data-tab="logout">
          <a href="{{ routes.account_logout_url }}" class="desktop-list">
            <span>Logout</span>
            <svg class="logout-icon" width="24" height="24" viewBox="0 0 24 24" fill="none">
              <path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4M16 17l5-5-5-5M21 12H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </a>
        </li>
      </ul>
      <div class="help-footer-links">
        <a href="{{ section.settings.help_support_link }}">Help and Support</a>
        <a href="{{ section.settings.terms_policies_link }}">Terms and Policies</a>
      </div>
    </div>

    <div class="my-profile" id="my-profile-section" style="display: none;">
      <!-- Profile Edit Modal -->
      <div class="profile-editModal" style="display: block;">
        <div class="profile-header">
          <h2>Edit Profile</h2>
        </div>

        <div class="profile-form-container">
          <form class="profile-edit-form">
            <!-- Name Row -->
            <div class="form-row">
              <div class="form-group">
                <label class="form-label" for="profileForm-FirstName"> First Name </label>
                <div class="field backg-color">
                  <input
                    class="input-content"
                    type="text"
                    id="profileForm-FirstName"
                    value="{{ customer.first_name }}"
                    placeholder="Enter First Name"
                  >
                </div>
              </div>

              <div class="form-group">
                <label class="form-label" for="profileForm-LastName"> Last Name </label>
                <div class="field backg-color">
                  <input
                    class="input-content"
                    type="text"
                    id="profileForm-LastName"
                    value="{{ customer.last_name }}"
                    placeholder="Enter Last Name"
                  >
                </div>
              </div>
            </div>

            <!-- Email Row -->
            <div class="form-row">
              <div class="form-group">
                <label class="form-label" for="profileForm-Email"> Email ID </label>
                <div class="field backg-color">
                  <input
                    class="input-content"
                    type="email"
                    id="profileForm-Email"
                    value="{{ customer.email }}"
                    disabled
                  >
                </div>
              </div>

              <div class="form-group">
                <label class="form-label" for="profileForm-Phone"> Phone No. </label>
                <div class="field phone-input-container">
                  <div class="phone-prefix">+91</div>
                  <input
                    class="input-content"
                    type="tel"
                    id="profileForm-Phone"
                    value="{% if customer.phone %}{{ customer.phone }}{% endif %}"
                    placeholder="Enter Phone Number"
                  >
                </div>
              </div>
            </div>

            <!-- Date and Gender Row -->
            <div class="form-row">
              <div class="form-group ">
                <label class="form-label" for="profileForm-Birthdate"> Date of Birth </label>
                <div class="field backg-color">
                  <input
                    class="input-content my-profile-date"
                    style="text-transform: uppercase;"
                    type="date"
                    id="profileForm-Birthdate"
                    placeholder="DD / MM / YYYY"
                  >
                </div>
              </div>

              <div class="form-group">
                <label class="form-label" for="profileForm-Gender"> Gender </label>
                <div class="field">
                  <div class="gender-options">
                    <label class="radio-option" data-gender="male">
                      <input class="input-content" type="radio" name="gender" value="male" id="gender-male">
                      <span>Male</span>
                    </label>
                    <label class="radio-option" data-gender="female">
                      <input class="input-content" type="radio" name="gender" value="female" id="gender-female">
                      <span>Female</span>
                    </label>
                    <label class="radio-option" data-gender="other">
                      <input class="input-content" type="radio" name="gender" value="other" id="gender-other">
                      <span>Other</span>
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </form>
        </div>

        <!-- Error/Status Messages -->
        <div class="form-messages">
          <div class="profileForm-errors" style="display: none;"></div>
        </div>

        <!-- Action Buttons -->
        <div class="profile-footer">
          <button onclick="saveProfile()" class="update-btn">Update Details</button>
          <div class="profileForm-status" style="display: none;">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12.9999 8.00019L8.99985 12.0002L6.99985 10.0002M11.2459 1.45919L12.4669 2.49919C12.7749 2.76119 13.1569 2.91919 13.5589 2.95219L15.1589 3.08019C15.6136 3.11651 16.0406 3.31357 16.3633 3.63607C16.686 3.95858 16.8833 4.38544 16.9199 4.84019L17.0469 6.44019C17.0799 6.84319 17.2389 7.22619 17.5009 7.53319L18.5409 8.75319C18.8373 9.10069 19.0001 9.54246 19.0001 9.99919C19.0001 10.4559 18.8373 10.8977 18.5409 11.2452L17.5009 12.4662C17.2389 12.7742 17.0799 13.1562 17.0479 13.5592L16.9199 15.1592C16.8835 15.614 16.6865 16.0409 16.364 16.3636C16.0415 16.6863 15.6146 16.8836 15.1599 16.9202L13.5599 17.0482C13.157 17.0801 12.7745 17.2383 12.4669 17.5002L11.2459 18.5402C10.8984 18.8366 10.4566 18.9994 9.99985 18.9994C9.54312 18.9994 9.10135 18.8366 8.75385 18.5402L7.53385 17.5002C7.22589 17.2381 6.84302 17.0799 6.43985 17.0482L4.83985 16.9202C4.38495 16.8836 3.95795 16.6861 3.63543 16.3633C3.3129 16.0404 3.11594 15.6131 3.07985 15.1582L2.95185 13.5592C2.91947 13.1566 2.76095 12.7745 2.49885 12.4672L1.45885 11.2452C1.16298 10.8978 1.00049 10.4565 1.00049 10.0002C1.00049 9.54391 1.16298 9.10255 1.45885 8.75519L2.49885 7.53319C2.76185 7.22519 2.91885 6.84319 2.95085 6.44019L3.07885 4.84119C3.11526 4.38595 3.31275 3.95859 3.63587 3.63584C3.95899 3.31309 4.38657 3.11609 4.84185 3.08019L6.43985 2.95319C6.84279 2.92101 7.22529 2.76248 7.53285 2.50019L8.75385 1.46019C9.10135 1.16379 9.54312 1.00098 9.99985 1.00098C10.4566 1.00098 10.8984 1.16279 11.2459 1.45919Z" stroke="#169B40" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Changes Saved.
          </div>
          <div class="profileForm-errors" style="display: none; color:red">Error</div>
        </div>
      </div>
    </div>

    <div class="account-content">
      <!-- My Orders Tab -->
      <div id="my-orders" class="tab-content active">
        <!-- Orders List View -->

        <div class="orders-list-view active">
          {% if customer.orders_count < 1 %}
            <div class="orders-header">
              <h2 class="empty-title-desk">My Orders</h2>
              <div class="online-instore-link">
                <span class="active">Online</span>
                <span class="">Instore</span>
              </div>
            </div>
            <div class="empty-orders">
              {{
                section.settings.empty_orders_image
                | image_url: width: 244
                | image_tag: widths: '244', loading: 'lazy', height: '203px', class: 'image-print'
              }}
              <div class="empty-cart-datails">
                <div class="empty-cart-text">
                  <p class="empty-title empty-title-desk">Your online cart is waiting</p>
                  <p class="empty-subtitle empty-title-desk">Shop now and track your orders right here.</p>

                  <p class="empty-title empty-title-mob">Did you shop at our store?</p>
                  <p class="empty-subtitle empty-title-mob">
                    Your past purchases from our stores <br>
                    will appear in this section.
                  </p>
                </div>
                <a href="{{section.settings.empty_shopnow_link}}" class="empty-title-desk">Shop Now</a>
                <a href="{{section.settings.empty_shopnow_link}}" class="empty-title-mob">Find Nearby Store</a>
              </div>
            </div>
          {% else %}
            <div class="orders-header">
              <h2 class="empty-title-desk">My Orders</h2>
              <div class="online-instore-link">
                <span class="active">Online</span>
                <span class="">Instore</span>
              </div>
            </div>

            <ul class="order-data">
              {% for order in customer.orders %}
                <li class="order-slide" data-order-id="{{ order.id }}">
                  <p class="order-state-number">
                    {% if order.fulfillment_status == 'fulfilled' %}
                      <span class="order-status" style="color: var(--color-spring-green-35, rgba(22, 155, 64, 1));"
                        >Your Order is Fulfilled</span
                      >
                    {% else %}
                      <span class="order-status">Your Order is Unfulfilled</span>
                    {% endif %}

                    <span class="order-number">Order ID {{ order.name }}</span>
                  </p>

                  <div class="order-detail-container">
                    {{
                      order.line_items[0].image
                      | image_url: width: 260
                      | image_tag: widths: '150, 260', loading: 'lazy', height: '150px', class: ''
                    }}
                    <div class="order-contents">
                      <div>
                        <p class="order-product-title">{{ order.line_items[0].title }}</p>
                        {% if order.line_items.size >= 2 %}
                          <p class="order-counts">+ {{ order.line_items.size | minus: 1 }} more</p>
                        {% endif %}
                      </div>

                      {% if order.cancelled %}
                      {% elsif order.fulfillment_status == 'success' or order.fulfillment_status == 'fulfilled' %}
                        <p class="order-slide-btn">
                          <svg
                            width="21"
                            height="22"
                            viewBox="0 0 21 22"
                            fill="none"
                            xmlns="http://www.w3.org/2000/svg"
                          >
                            <path d="M17.5 2.25H3.5C2.5375 2.25 1.75 3.0375 1.75 4V19.75L5.25 16.25H17.5C18.4625 16.25 19.25 15.4625 19.25 14.5V4C19.25 3.0375 18.4625 2.25 17.5 2.25ZM17.5 14.5H4.52375L3.5 15.5238V4H17.5V14.5Z" fill="#462D8C"/>
                            <path d="M10.5 13.625L11.8737 10.6237L14.875 9.25L11.8737 7.87625L10.5 4.875L9.12625 7.87625L6.125 9.25L9.12625 10.6237L10.5 13.625Z" fill="#462D8C"/>
                          </svg>
                          Write a Review
                        </p>
                      {% else %}
                        <a href="{{ section.settings.track_order_link }}" class="order-slide-btn">
                          <svg
                            width="21"
                            height="22"
                            viewBox="0 0 21 22"
                            fill="none"
                            xmlns="http://www.w3.org/2000/svg"
                          >
                            <path d="M15.2909 17.7207C14.2978 18.4287 13.1437 18.9229 11.8925 19.1338V18.3662C12.9401 18.1723 13.9065 17.7581 14.7518 17.1777L15.2909 17.7207ZM9.1073 3.6377C5.64575 4.30607 3.02634 7.35287 3.02625 11C3.02625 14.6471 5.64581 17.6928 9.1073 18.3613V19.1289C5.22703 18.4518 2.27625 15.0653 2.27625 11C2.27634 6.93468 5.22698 3.54708 9.1073 2.87012V3.6377ZM18.6512 12.375C18.4403 13.6263 17.9461 14.7803 17.2382 15.7734L16.6952 15.2344C17.2756 14.389 17.6908 13.4228 17.8846 12.375H18.6512ZM10.4999 7.125C12.0768 7.125 13.4999 8.32558 13.4999 10.2129C13.4998 10.8048 13.2616 11.5017 12.7118 12.3135C12.2161 13.0453 11.4829 13.8446 10.4999 14.7119C9.51686 13.8446 8.7836 13.0453 8.28796 12.3135C7.73816 11.5017 7.49993 10.8048 7.49988 10.2129C7.49988 8.32563 8.92301 7.12506 10.4999 7.125ZM10.4999 8.62793C9.7077 8.62799 9.06361 9.27134 9.06335 10.0635C9.06335 10.8558 9.70754 11.4999 10.4999 11.5C11.2923 11.5 11.9364 10.8559 11.9364 10.0635C11.9361 9.2713 11.2921 8.62793 10.4999 8.62793ZM17.2391 6.22754C17.9467 7.2204 18.4404 8.37424 18.6512 9.625H17.8846C17.6908 8.57791 17.276 7.61205 16.6952 6.77148L17.2391 6.22754ZM11.8925 2.86523C13.139 3.07637 14.2964 3.57208 15.2899 4.2793L14.7518 4.82227C13.9065 4.24193 12.9401 3.82769 11.8925 3.63379V2.86523Z" stroke="#462D8C"/>
                          </svg>
                          Track Order
                        </a>
                      {% endif %}
                    </div>
                  </div>
                </li>
              {% endfor %}
              <div class="view-more-container" style="display: none;">
                <button class="view-more-orders-btn">
                  <span>View More Orders</span>
                </button>
              </div>
            </ul>
          {% endif %}
          <div class="mobile-profile-image">
            <div class="mobile-profile-image help-footer-links">
              <a href="{{ section.settings.help_support_link }}">Help and Support</a>
              <a href="{{ section.settings.terms_policies_link }}">Terms and Policies</a>
            </div>
          </div>
        </div>

        <div class="order-details-view">
          {% for order in customer.orders %}
            <div class="order-details-content" id="order-details-{{ order.id }}" data-order-id="{{ order.id }}">
              <div class="order-details-body">
                <div class="order-header-info">
                  <div class="order-details-heading-content">
                    <h2 class="order-status-header">
                      <span class="desktop-profile-image" onclick="desktopBred()">
                        <svg
                          fill="#000000"
                          xmlns="http://www.w3.org/2000/svg"
                          width="800px"
                          height="800px"
                          viewBox="0 0 52 52"
                          enable-background="new 0 0 52 52"
                          xml:space="preserve"
                        >
                          <path d="M48.6,23H15.4c-0.9,0-1.3-1.1-0.7-1.7l9.6-9.6c0.6-0.6,0.6-1.5,0-2.1l-2.2-2.2c-0.6-0.6-1.5-0.6-2.1,0
                          	L2.5,25c-0.6,0.6-0.6,1.5,0,2.1L20,44.6c0.6,0.6,1.5,0.6,2.1,0l2.1-2.1c0.6-0.6,0.6-1.5,0-2.1l-9.6-9.6C14,30.1,14.4,29,15.3,29
                          	h33.2c0.8,0,1.5-0.6,1.5-1.4v-3C50,23.8,49.4,23,48.6,23z"/>
                        </svg>
                      </span>

                      <span>Order Details</span>
                      <a href="{{section.settings.chat_support_link}}" class="empty-title-mob">
                        <svg
                          width="24"
                          height="24"
                          viewBox="0 0 24 24"
                          fill="none"
                          xmlns="http://www.w3.org/2000/svg"
                        >
                          <path d="M20 4.70288V16.7029H5.17L4 17.8729V4.70288H20ZM20 2.70288H4C2.9 2.70288 2 3.60288 2 4.70288V20.2929C2 21.1829 3.08 21.6329 3.71 21.0029L6 18.7029H20C21.1 18.7029 22 17.8029 22 16.7029V4.70288C22 3.60288 21.1 2.70288 20 2.70288Z" fill="black"/>
                        </svg>
                      </a>
                    </h2>
                    <div class="order-dates">
                      <span class="order-placed"
                        >Order Placed:
                        <span class="order-placed-date">{{ order.created_at | date: '%dth %B %Y' }}</span></span
                      >
                      <span class="order-id-display"
                        >Order ID: <span class="order-id-number">{{ order.name }}</span></span
                      >
                    </div>
                  </div>
                  <div class="order-arriving-details">
                    {% if order.fulfillment_status == 'fulfilled' %}
                      <span class="order-status" style="color: var(--color-spring-green-35, rgba(22, 155, 64, 1));"
                        >Your Order is Fulfilled</span
                      >
                    {% else %}
                      <span class="order-status">Your Order is Unfulfilled</span>
                    {% endif %}
                    <a
                      href="{{ section.settings.track_order_link }}/my-order?order_id={{ order.name | remove_first: '#' }}"
                      class="details-tacking"
                      >Track Order</a
                    >
                  </div>
                </div>
              </div>

              <div class="order-details-content-inner">
                <!-- Products Section -->
                <div class="order-products-section">
                  <div class="products-list">
                    {% for item in order.line_items %}
                      <div class="order-detail-product">
                        <div class="product-image">
                          {{
                            item.image
                            | image_url: width: 150
                            | image_tag: widths: '100, 150', loading: 'lazy', height: '141px'
                          }}
                        </div>
                        <div class="product-info">
                          <h4 class="product-title">{{ item.title }}</h4>
                          {% if item.product.type == 'Scrubs'
                            or item.product.type == 'Lab Coats'
                            or item.product.type == 'Lab Coats'
                            or item.product.type == 'Underscrubs'
                          %}
                            {% assign variant_parts = item.variant.title | split: ' / ' %}
                            <div class="empty-title-desk">
                              <div class="size-datails-coantainer">
                                {% if variant_parts.size > 0 %}
                                  <p class="variant-title">
                                    Top Size: <span>{{ variant_parts[0] }}</span>
                                  </p>
                                {% endif %}
                                {% if variant_parts.size > 1 %}
                                  <p class="variant-title">
                                    Bottom Size: <span>{{ variant_parts[1] }}</span>
                                  </p>
                                {% endif %}
                                {% if variant_parts.size > 2 %}
                                  <p class="variant-title">
                                    Bottom Style: <span>{{ variant_parts[2] }}</span>
                                  </p>
                                {% endif %}
                                {% if item.variant_title %}
                                  <p class="variant-title">{{ item.variant_title }}</p>
                                {% endif %}
                              </div>
                            </div>

                            <div class="empty-title-mob">
                              <div class="size-datails-coantainer">
                                {% if variant_parts.size > 0 %}
                                  <p class="variant-title">
                                    Top Size:
                                    <span>
                                      {{- variant_parts[0] }}
                                      {% if variant_parts.size > 1 %}
                                        <span class="empty-title-mob"> | </span>
                                      {%- endif -%}
                                    </span>
                                  </p>
                                {% endif %}
                                {% if variant_parts.size > 1 %}
                                  <p class="variant-title">
                                    Bottom Size:
                                    <span>
                                      {{- variant_parts[1] }}
                                      {% if variant_parts.size > 2 %}
                                        <span class="empty-title-mob"> | </span>
                                      {%- endif -%}
                                    </span>
                                  </p>
                                {% endif %}
                                {% if variant_parts.size > 2 %}
                                  <p class="variant-title">
                                    Bottom Style:
                                    <span>
                                      {{- variant_parts[2] }}
                                      {% if item.variant_title %}
                                        <span class="empty-title-mob"> | </span>
                                      {%- endif -%}
                                    </span>
                                  </p>
                                {% endif %}
                                {% if item.variant_title %}
                                  <p class="variant-title">{{ item.variant_title }}</p>
                                {% endif %}
                              </div>
                            </div>
                          {% endif %}

                          {% if item.product.type == 'Embroidery' %}
                            <div class="embroidery-details">
                              {% for property in item.properties %}
                                {% case property.first %}
                                  {% when 'Text' %}
                                    <p class="variant-title">Selected: <span>Text</span></p>
                                    <p class="variant-title">
                                      Name: <span>{{ property.last }}</span>
                                    </p>
                                  {% when 'Color' %}
                                    <p class="variant-title">
                                      Color:
                                      <span>
                                        {{- property.last -}}
                                        <span class="empty-title-mob"> | </span></span
                                      >
                                    </p>
                                  {% when 'Font' %}
                                    <p class="variant-title">
                                      Font Style: <span>{{ property.last }}</span>
                                    </p>
                                {% endcase %}
                              {% endfor %}
                            </div>
                          {% endif %}
                        </div>
                        {% assign item_type_lower = item.product.type | downcase %}
                        {% if order.fulfillment_status == 'fulfilled'
                          and item_type_lower != 'engraving'
                          and item_type_lower != 'embroidery'
                        %}
                          <div class="delivered-btns empty-title-desk ">
                            <a href="{{ section.settings.return_and_exchange_url }}" class="track-order-btn"
                              >Return and Exchange</a
                            >
                            <a href="{{ item.url }}#main-div-review" class="cancel-order-btn">Write a Review</a>
                          </div>
                        {% endif %}
                      </div>
                    {% endfor %}
                    {% if order.fulfillment_status == 'fulfilled' %}
                      <div class="reorder-return-exchange-btn delivered-status-btns">
                        <a href="{{ section.settings.reorder_url }}" class="cancel-order-btn">Reorder</a>
                        <a href="{{ section.settings.return_and_exchange_url }}" class="track-order-btn"
                          >Return and Exchange</a
                        >
                      </div>
                    {% endif %}
                  </div>
                </div>

                <!-- Bottom Section with Delivery Details and Summary -->
                <div class="order-bottom-section">
                  <!-- Delivery Details -->
                  <div class="delivery-details">
                    <div class="delivery-header">
                      <h3>Delivery Details</h3>
                      <span class="delivery-type">Home</span>
                    </div>
                    <div class="delivery-info">
                      <div class="delivery-row">
                        <span class="delivery-label">Name:</span>
                        <span class="delivery-value">
                          {{ customer.first_name }}
                          {{ customer.last_name }}
                        </span>
                      </div>
                      <div class="delivery-row">
                        <span class="delivery-label">Phone No.:</span>
                        <span class="delivery-value">{{ customer.phone | default: '+91 98765 43210' }}</span>
                      </div>
                      <div class="delivery-row">
                        <span class="delivery-label">Address:</span>
                        <span class="delivery-value">
                          {% if customer.default_address %}
                            {{ customer.default_address.address1 }}
                            {% if customer.default_address.address2 %}
                              <br>
                              {{ customer.default_address.address2 }}
                            {% endif %}
                          {% else %}

                          {% endif %}
                        </span>
                      </div>
                      <div class="delivery-row">
                        <span class="delivery-label">Landmark:</span>
                        <span class="delivery-value">
                          {{ customer.default_address.company | default: 'Opposite Medanta Medicity' }}
                        </span>
                      </div>
                    </div>
                  </div>

                  <!-- Order Summary -->
                  <div class="order-summary">
                    <h3>Order Summary</h3>
                    {% assign subtotal = 0 %}
                    {% for item in order.line_items %}
                      {% assign line_total = item.original_price | times: item.quantity %}
                      {% assign subtotal = subtotal | plus: line_total %}
                    {% endfor %}
                    <div class="summary-details">
                      <div class="summary-row">
                        <span class="summary-label">Item Subtotal</span>
                        <span class="summary-value subtotal-amount">₹{{ subtotal | money_without_currency }} </span>
                      </div>
                      <div class="summary-row">
                        <span class="summary-label">Shipping</span>
                        <span class="summary-value shipping-amount">
                          {% if order.shipping_price and order.shipping_price > 0 %}
                            ₹{{ order.shipping_price | money_without_currency }}
                          {% else %}
                            <span style="color: #169B40;">Free</span>
                          {% endif %}
                        </span>
                      </div>
                      {% if order.total_discounts > 0 %}
                        <div class="summary-row discount-row">
                          <span class="summary-label">Discount</span>
                          <span class="summary-value discount-amount"
                            >- ₹{{ order.total_discounts | money_without_currency -}}
                          </span>
                        </div>
                      {% endif %}
                      <div class="summary-row total-row">
                        <span class="summary-label">Total</span>
                        <span class="summary-value">
                          {% assign original_total = order.subtotal_price %}
                          {% if order.shipping_price %}
                            {% assign original_total = original_total | plus: order.shipping_price %}
                          {% endif %}
                          {% if order.total_discounts > 0 %}
                            <span class="original-total">₹{{ subtotal | money_without_currency }}</span>
                          {% endif %}
                          <span class="final-total">₹{{ order.total_price | money_without_currency }}</span>
                        </span>
                      </div>
                      {% if order.total_discounts > 0 %}
                        {% assign savings = subtotal | minus: order.total_price %}
                        <div class="savings-banner">
                          <span class="savings-text"
                            >Saving ₹<span class="savings-amount">{{ savings | money_without_currency }}</span> on the
                            order</span
                          >
                        </div>
                      {% endif %}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      </div>

      <div id="my-address" class="tab-content">
        <div class="saved-addresses-container">
          <h2 class="saved-addresses-title">
            <svg
              width="24"
              onclick="saveAddressBack()"
              height="24"
              class="mobile-views"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path d="M15 6.70461C14.61 6.31461 13.98 6.31461 13.59 6.70461L9 11.2946C8.61 11.6846 8.61 12.3146 9 12.7046L13.59 17.2946C13.98 17.6846 14.61 17.6846 15 17.2946C15.39 16.9046 15.39 16.2746 15 15.8846L11.12 11.9946L15 8.11461C15.39 7.72461 15.38 7.08461 15 6.70461Z" fill="#000000"/>
            </svg>

            Saved Addresses
          </h2>

          <div class="addresses-grid">
            {%- for address in customer.addresses -%}
              <div
                class="address-card {% if address == customer.default_address %} default-add {%- endif -%}"
                data-address-id="{{ address.id }}"
              >
                <div class="address-card-header">
                  <h3 class="address-type">
                    {%- if address == customer.default_address -%}
                      Default
                      {% comment %} <span class="default-badge">Default</span> {% endcomment %}
                    {%- else -%}
                      Address {{ forloop.index }}
                    {%- endif -%}
                  </h3>
                </div>

                <div class="address-card-body">
                  <p class="address-name address-sec-content">
                    {{ address.first_name }}
                    {{ address.last_name }}
                  </p>
                  <p class="address-phone address-sec-content">+91 {{ address.phone }}</p>
                  <p class="address-line address-sec-content">
                    {{ address.address1 }}
                    {% if address.address2 != blank %}
                      , {{ address.address2 }}
                    {% endif %}
                    , {{ address.city }}, {{ address.province }}, {{ address.zip }}
                  </p>
                  <p class="address-landmark address-sec-content">{{ address.company }}</p>
                </div>

                <div class="address-card-footer">
                  <button class="address-action-btn edit-btn" onclick="openEditAddressModal('{{ address.id }}')">
                    Edit
                  </button>
                  {%- if address != customer.default_address -%}
                    <button
                      class="address-action-btn remove-btn"
                      onclick="deleteAddress('{{ address.id }}', '{{ address.url }}')"
                    >
                      Remove
                    </button>
                    <button class="address-action-btn default-btn" onclick="setAsDefault('{{ address.id }}')">
                      Set as default
                    </button>
                  {%- else -%}
                    <button
                      class="address-action-btn remove-btn"
                      onclick="deleteAddress('{{ address.id }}', '{{ address.url }}')"
                    >
                      Remove
                    </button>
                  {%- endif -%}
                </div>
              </div>
            {%- endfor -%}
            <div class="view-more-address-pgn">
              <div class="view-more-btn-mob">
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M9 3.75V14.25M3.75 9H14.25" stroke="#462D8C" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span>View More</span>
              </div>
            </div>

            <!-- Add New Address Button -->
            <div class="address-card add-new-card" onclick="openAddAddressModal()">
              <div class="add-new-content">
                <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M9 3.75V14.25M3.75 9H14.25" stroke="#462D8C" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span>Add new address</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Add Address Modal -->
        <div class="address-modal" id="add-address-modal" style="display: none;">
          <div class="address-modal-content">
            <div class="address-modal-header">
              <button class="back-btn" onclick="closeAddAddressModal()">
                <svg width="28" height="29" viewBox="0 0 28 29" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M17.4999 8.32172C17.0449 7.86672 16.3099 7.86672 15.8549 8.32172L10.4999 13.6767C10.0449 14.1317 10.0449 14.8667 10.4999 15.3217L15.8549 20.6767C16.3099 21.1317 17.0449 21.1317 17.4999 20.6767C17.9549 20.2217 17.9549 19.4867 17.4999 19.0317L12.9733 14.4934L17.4999 9.96672C17.9549 9.51172 17.9433 8.76505 17.4999 8.32172Z" fill=""/>
                </svg>
              </button>
              <h2>Add a new address</h2>
            </div>
            <div class="address-modal-body">
              {%- form 'customer_address', customer.new_address -%}
                <div class="address-form-checkbox">
                  <input type="checkbox" id="new-address-default" name="address[default]">
                  <label for="new-address-default">Set as default address</label>
                </div>

                <div class="address-form-row">
                  <div class="address-form-group">
                    <label for="AddressFirstNameNew">Receiver's Name</label>
                    <div class="name-inputs-wrapper">
                      <input
                        type="text"
                        id="AddressFirstNameNew"
                        name="address[first_name]"
                        placeholder="First Name"
                        autocomplete="given-name"
                      >
                      <input
                        type="text"
                        id="AddressLastNameNew"
                        name="address[last_name]"
                        placeholder="Last Name"
                        autocomplete="family-name"
                      >
                    </div>
                    <div
                      class="address-error-message text-for-form-validate"
                      id="error-AddressFirstNameNew"
                      style="display: none;"
                    ></div>
                  </div>

                  <div class="address-form-group">
                    <label for="AddressPhoneNew">Receiver's Phone Number </label>
                    <input
                      type="tel"
                      id="AddressPhoneNew"
                      name="address[phone]"
                      placeholder="e.g. 9876543210"
                      autocomplete="tel"
                      maxlength="10"
                      pattern="[0-9]{10}"
                      inputmode="numeric"
                    >
                    <div
                      class="address-error-message text-for-form-validate"
                      id="error-AddressPhoneNew"
                      style="display: none;"
                    ></div>
                    <small class="form-helper-text"
                      >We will call you at <span class="addPhone">0000 0000 00</span>, if you are unavailable on this
                      number</small
                    >
                  </div>
                </div>

                <div class="address-form-row">
                  <div class="address-form-group">
                    <label for="AddressAddress1New">Address line 1 </label>
                    <input
                      type="text"
                      id="AddressAddress1New"
                      name="address[address1]"
                      placeholder="Flat, House no., Building, Company, Apartment"
                      autocomplete="address-line1"
                    >
                    <div
                      class="address-error-message text-for-form-validate"
                      id="error-AddressAddress1New"
                      style="display: none;"
                    ></div>
                  </div>

                  <div class="address-form-group">
                    <label for="AddressAddress2New">Address line 2</label>
                    <input
                      type="text"
                      id="AddressAddress2New"
                      name="address[address2]"
                      placeholder="Area, Street, Sector, Village"
                      autocomplete="address-line2"
                    >
                  </div>
                </div>

                <div class="address-form-row">
                  <div class="address-form-group">
                    <label for="AddressZipNew">Pincode</label>
                    <input
                      type="text"
                      id="AddressZipNew"
                      name="address[zip]"
                      placeholder="e.g. 400013"
                      autocomplete="postal-code"
                    >
                    <div
                      class="address-error-message text-for-form-validate"
                      id="error-AddressZipNew"
                      style="display: none; "
                    ></div>
                  </div>

                  <div class="address-form-group">
                    <label for="AddressCityNew">City</label>
                    <input
                      type="text"
                      id="AddressCityNew"
                      name="address[city]"
                      placeholder="e.g. Mumbai"
                      autocomplete="address-level2"
                    >
                  </div>
                </div>

                <div class="address-form-row">
                  <div class="address-form-group">
                    <label for="AddressProvinceNew">State</label>
                    <input
                      type="text"
                      id="AddressProvinceNew"
                      name="address[province]"
                      placeholder="e.g. Maharashtra"
                      autocomplete="address-level1"
                    >
                  </div>

                  <div class="address-form-group">
                    <label for="AddressCompanyNew">Landmark</label>
                    <input
                      type="text"
                      id="AddressCompanyNew"
                      name="address[company]"
                      placeholder="e.g. Near City Mall (Optional)"
                      autocomplete="organization"
                    >
                  </div>
                </div>

                <div class="address-form-row update-btn-field">
                  <div class="address-form-group full-width">
                    <label>Save as</label>
                    <div class="otherBtnFunc">
                      <div class="save-as-options">
                        <label class="save-as-option addhome active">
                          <input type="radio" name="address_type" value="home" checked>
                          <svg
                            width="20"
                            height="20"
                            viewBox="0 0 20 20"
                            fill="none"
                            xmlns="http://www.w3.org/2000/svg"
                          >
                            <path d="M9.79939 5.3383C9.91348 5.23562 10.0867 5.23562 10.2008 5.3383L14.1667 8.90768V15.116C14.1667 15.2817 14.0324 15.416 13.8667 15.416H12.8001C12.6344 15.416 12.5001 15.2817 12.5001 15.116V10.916C12.5001 10.6399 12.2762 10.416 12.0001 10.416H8.00008C7.72394 10.416 7.50008 10.6399 7.50008 10.916V15.116C7.50008 15.2817 7.36577 15.416 7.20008 15.416H6.13341C5.96773 15.416 5.83342 15.2817 5.83342 15.116V8.90768L9.79939 5.3383ZM10.3346 3.21705C10.1444 3.04591 9.85575 3.04591 9.6656 3.21705L2.44154 9.7187C2.16906 9.96394 2.34254 10.416 2.70913 10.416H4.16675V16.5827C4.16675 16.8588 4.39061 17.0827 4.66675 17.0827H8.66675C8.94289 17.0827 9.16675 16.8588 9.16675 16.5827V12.3827C9.16675 12.217 9.30106 12.0827 9.46675 12.0827H10.5334C10.6991 12.0827 10.8334 12.217 10.8334 12.3827V16.5827C10.8334 16.8588 11.0573 17.0827 11.3334 17.0827H15.3334C15.6096 17.0827 15.8334 16.8588 15.8334 16.5827V10.416H17.291C17.6576 10.416 17.8311 9.96394 17.5586 9.7187L10.3346 3.21705Z" fill=""/>
                          </svg>
                          Home
                        </label>

                        <label class="save-as-option addoffice ">
                          <input type="radio" name="address_type" value="work">
                          <svg
                            width="20"
                            height="20"
                            viewBox="0 0 20 20"
                            fill="none"
                            xmlns="http://www.w3.org/2000/svg"
                          >
                            <path d="M11.6667 5.41732V3.75065H8.33342V5.41732H11.6667ZM3.33341 7.91732V15.4173C3.33341 15.8757 3.70841 16.2507 4.16675 16.2507H15.8334C16.2917 16.2507 16.6667 15.8757 16.6667 15.4173V7.91732C16.6667 7.45898 16.2917 7.08398 15.8334 7.08398H4.16675C3.70841 7.08398 3.33341 7.45898 3.33341 7.91732ZM16.6667 5.41732C17.5917 5.41732 18.3334 6.15898 18.3334 7.08398V16.2507C18.3334 17.1757 17.5917 17.9173 16.6667 17.9173H3.33341C2.40841 17.9173 1.66675 17.1757 1.66675 16.2507L1.67508 7.08398C1.67508 6.15898 2.40841 5.41732 3.33341 5.41732H6.66675V3.75065C6.66675 2.82565 7.40841 2.08398 8.33342 2.08398H11.6667C12.5917 2.08398 13.3334 2.82565 13.3334 3.75065V5.41732H16.6667Z" fill=""/>
                          </svg>
                          Work
                        </label>

                        <label class="save-as-option addOthers">
                          <input type="radio" name="address_type" value="others">
                          <svg
                            width="20"
                            height="20"
                            viewBox="0 0 20 20"
                            fill="none"
                            xmlns="http://www.w3.org/2000/svg"
                          >
                            <path d="M10.0001 1.66602C6.77508 1.66602 4.16675 4.27435 4.16675 7.49935C4.16675 11.8743 10.0001 18.3327 10.0001 18.3327C10.0001 18.3327 15.8334 11.8743 15.8334 7.49935C15.8334 4.27435 13.2251 1.66602 10.0001 1.66602ZM5.83341 7.49935C5.83341 5.19935 7.70008 3.33268 10.0001 3.33268C12.3001 3.33268 14.1667 5.19935 14.1667 7.49935C14.1667 9.89935 11.7667 13.491 10.0001 15.7327C8.26675 13.5077 5.83341 9.87435 5.83341 7.49935Z" fill=""/>
                            <path d="M10.0001 9.58268C11.1507 9.58268 12.0834 8.64994 12.0834 7.49935C12.0834 6.34876 11.1507 5.41602 10.0001 5.41602C8.84949 5.41602 7.91675 6.34876 7.91675 7.49935C7.91675 8.64994 8.84949 9.58268 10.0001 9.58268Z" fill=""/>
                          </svg>
                          Others
                        </label>
                      </div>
                      <div class="input-wrapper">
                        <input type="text" onchange="changeingOtherAdd()" class="addinputForOther hide">
                        <svg
                          width="16"
                          height="16"
                          onclick="clearOtherVal()"
                          viewBox="0 0 16 16"
                          class="closeIconOther hide"
                          fill="none"
                          xmlns="http://www.w3.org/2000/svg"
                        >
                          <path d="M12.2 3.80714C11.94 3.54714 11.52 3.54714 11.26 3.80714L7.99998 7.06047L4.73998 3.80047C4.47998 3.54047 4.05998 3.54047 3.79998 3.80047C3.53998 4.06047 3.53998 4.48047 3.79998 4.74047L7.05998 8.00047L3.79998 11.2605C3.53998 11.5205 3.53998 11.9405 3.79998 12.2005C4.05998 12.4605 4.47998 12.4605 4.73998 12.2005L7.99998 8.94047L11.26 12.2005C11.52 12.4605 11.94 12.4605 12.2 12.2005C12.46 11.9405 12.46 11.5205 12.2 11.2605L8.93998 8.00047L12.2 4.74047C12.4533 4.48714 12.4533 4.06047 12.2 3.80714Z" fill="#999999"/>
                        </svg>
                      </div>
                    </div>
                  </div>
                  <div class="address-form-actions">
                    <button
                      type="submit"
                      class="btn-update-address"
                      id="btn-add-address"
                      disabled
                      style="opacity: 0.5; cursor: not-allowed;"
                    >
                      Update
                    </button>
                  </div>
                </div>
                <input type="hidden" name="address[country]" value="India">
              {%- endform -%}
            </div>
          </div>
        </div>

        <!-- Edit Address Modal -->
        <div class="address-modal" id="edit-address-modal" style="display: none;">
          <div class="address-modal-content">
            <div class="address-modal-header">
              <button class="back-btn" onclick="closeEditAddressModal()">
                <svg width="28" height="29" viewBox="0 0 28 29" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M17.4999 8.32172C17.0449 7.86672 16.3099 7.86672 15.8549 8.32172L10.4999 13.6767C10.0449 14.1317 10.0449 14.8667 10.4999 15.3217L15.8549 20.6767C16.3099 21.1317 17.0449 21.1317 17.4999 20.6767C17.9549 20.2217 17.9549 19.4867 17.4999 19.0317L12.9733 14.4934L17.4999 9.96672C17.9549 9.51172 17.9433 8.76505 17.4999 8.32172Z" fill="black"/>
                </svg>
              </button>
              <h2>Edit your address</h2>
            </div>

            <div class="address-modal-body" id="edit-address-form-container">
              {%- for address in customer.addresses -%}
                <div class="edit-address-form" id="edit-form-{{ address.id }}" style="display: none;">
                  {%- form 'customer_address', address -%}
                    <div class="address-form-checkbox">
                      <input
                        type="checkbox"
                        id="edit-address-default-{{ address.id }}"
                        name="address[default]"
                        {% if address == customer.default_address %}
                          checked
                        {% endif %}
                      >
                      <label for="edit-address-default-{{ address.id }}">Set as default address</label>
                    </div>

                    <div class="address-form-row">
                      <div class="address-form-group">
                        <label for="AddressFirstName_{{ address.id }}">Receiver's Name</label>
                       <div class="name-inputs-wrapper">
                        <input
                          type="text"
                          id="AddressFirstName_{{ address.id }}"
                          name="address[first_name]"
                          value="{{ address.first_name }}"
                          placeholder="First Name"
                          autocomplete="given-name"
                          data-initial-value="{{ address.first_name }}"
                        >
                        <input
                          type="text"
                          id="AddressLastName_{{ address.id }}"
                          name="address[last_name]"
                          value="{{ address.last_name }}"
                          placeholder="Last Name"
                          autocomplete="family-name"
                          data-initial-value="{{ address.last_name }}"
                        >
                      </div>
                        <div
                          class="address-error-message text-for-form-validate"
                          id="error-AddressFirstName_{{ address.id }}"
                          style="display: none; "
                        ></div>
                      </div>

                      

                      <div class="address-form-group">
                        <label for="AddressPhone_{{ address.id }}">Receiver's Phone Number</label>
                        <input
                          type="tel"
                          id="AddressPhone_{{ address.id }}"
                          name="address[phone]"
                          value="{{ address.phone }}"
                          placeholder="e.g. 9876543210"
                          maxlength="10"
                          pattern="[0-9]{10}"
                          inputmode="numeric"
                          data-initial-value="{{ address.phone }}"
                        >
                        <div
                          class="address-error-message text-for-form-validate"
                          id="error-AddressPhone_{{ address.id }}"
                          style="display: none;"
                        ></div>
                        <small class="form-helper-text"
                          >We will call you at <span class="editPhone">{{ address.phone }}</span>, if you are
                          unavailable on this number</small
                        >
                      </div>
                    </div>

                    <div class="address-form-row">
                      <div class="address-form-group">
                        <label for="AddressAddress1_{{ address.id }}">Address line 1</label>
                        <input
                          type="text"
                          id="AddressAddress1_{{ address.id }}"
                          name="address[address1]"
                          value="{{ address.address1 }}"
                          placeholder="Flat, House no., Building, Company, Apartment"
                          data-initial-value="{{ address.address1 }}"
                        >
                        <div
                          class="address-error-message text-for-form-validate"
                          id="error-AddressAddress1_{{ address.id }}"
                          style="display: none;"
                        ></div>
                      </div>

                      <div class="address-form-group">
                        <label for="AddressAddress2_{{ address.id }}">Address line 2</label>
                        <input
                          type="text"
                          id="AddressAddress2_{{ address.id }}"
                          name="address[address2]"
                          value="{{ address.address2 }}"
                          placeholder="Area, Street, Sector, Village"
                          data-initial-value="{{ address.address2 }}"
                        >
                      </div>
                    </div>

                    <div class="address-form-row">
                      <div class="address-form-group">
                        <label for="AddressZip_{{ address.id }}">Pincode</label>
                        <input
                          type="text"
                          id="AddressZip_{{ address.id }}"
                          name="address[zip]"
                          value="{{ address.zip }}"
                          placeholder="e.g. 400013"
                          data-initial-value="{{ address.zip }}"
                        >
                        <div
                          class="address-error-message text-for-form-validate"
                          id="error-AddressZip_{{ address.id }}"
                          style="display: none;"
                        ></div>
                      </div>

                      <div class="address-form-group">
                        <label for="AddressCity_{{ address.id }}">City</label>
                        <input
                          type="text"
                          id="AddressCity_{{ address.id }}"
                          name="address[city]"
                          value="{{ address.city }}"
                          placeholder="e.g. Mumbai"
                          data-initial-value="{{ address.city }}"
                        >
                      </div>
                    </div>

                    <div class="address-form-row">
                      <div class="address-form-group">
                        <label for="AddressProvince_{{ address.id }}">State</label>
                        <input
                          type="text"
                          id="AddressProvince_{{ address.id }}"
                          name="address[province]"
                          value="{{ address.province }}"
                          placeholder="e.g. Maharashtra"
                          data-initial-value="{{ address.province }}"
                        >
                      </div>

                      <div class="address-form-group">
                        <label for="AddressCompany_{{ address.id }}">Landmark</label>
                        <input
                          type="text"
                          id="AddressCompany_{{ address.id }}"
                          name="address[company]"
                          value="{{ address.company }}"
                          placeholder="e.g. Near City Mall (Optional)"
                          data-initial-value="{{ address.company }}"
                        >
                      </div>
                    </div>

                    <div class="address-form-row update-btn-field">
                      <div class="address-form-group full-width">
                        <label>Save as</label>
                        <div class="save-as-options">
                          <label class="save-as-option">
                            <input type="radio" name="address_type_{{ address.id }}" value="home">
                            <svg
                              width="20"
                              height="20"
                              viewBox="0 0 20 20"
                              fill="none"
                              xmlns="http://www.w3.org/2000/svg"
                            >
                              <path d="M9.79939 5.3383C9.91348 5.23562 10.0867 5.23562 10.2008 5.3383L14.1667 8.90768V15.116C14.1667 15.2817 14.0324 15.416 13.8667 15.416H12.8001C12.6344 15.416 12.5001 15.2817 12.5001 15.116V10.916C12.5001 10.6399 12.2762 10.416 12.0001 10.416H8.00008C7.72394 10.416 7.50008 10.6399 7.50008 10.916V15.116C7.50008 15.2817 7.36577 15.416 7.20008 15.416H6.13341C5.96773 15.416 5.83342 15.2817 5.83342 15.116V8.90768L9.79939 5.3383ZM10.3346 3.21705C10.1444 3.04591 9.85575 3.04591 9.6656 3.21705L2.44154 9.7187C2.16906 9.96394 2.34254 10.416 2.70913 10.416H4.16675V16.5827C4.16675 16.8588 4.39061 17.0827 4.66675 17.0827H8.66675C8.94289 17.0827 9.16675 16.8588 9.16675 16.5827V12.3827C9.16675 12.217 9.30106 12.0827 9.46675 12.0827H10.5334C10.6991 12.0827 10.8334 12.217 10.8334 12.3827V16.5827C10.8334 16.8588 11.0573 17.0827 11.3334 17.0827H15.3334C15.6096 17.0827 15.8334 16.8588 15.8334 16.5827V10.416H17.291C17.6576 10.416 17.8311 9.96394 17.5586 9.7187L10.3346 3.21705Z" fill=""/>
                            </svg>
                            Home
                          </label>

                          <label class="save-as-option">
                            <input type="radio" name="address_type_{{ address.id }}" value="work">
                            <svg
                              width="20"
                              height="20"
                              viewBox="0 0 20 20"
                              fill="none"
                              xmlns="http://www.w3.org/2000/svg"
                            >
                              <path d="M11.6667 5.41732V3.75065H8.33342V5.41732H11.6667ZM3.33341 7.91732V15.4173C3.33341 15.8757 3.70841 16.2507 4.16675 16.2507H15.8334C16.2917 16.2507 16.6667 15.8757 16.6667 15.4173V7.91732C16.6667 7.45898 16.2917 7.08398 15.8334 7.08398H4.16675C3.70841 7.08398 3.33341 7.45898 3.33341 7.91732ZM16.6667 5.41732C17.5917 5.41732 18.3334 6.15898 18.3334 7.08398V16.2507C18.3334 17.1757 17.5917 17.9173 16.6667 17.9173H3.33341C2.40841 17.9173 1.66675 17.1757 1.66675 16.2507L1.67508 7.08398C1.67508 6.15898 2.40841 5.41732 3.33341 5.41732H6.66675V3.75065C6.66675 2.82565 7.40841 2.08398 8.33342 2.08398H11.6667C12.5917 2.08398 13.3334 2.82565 13.3334 3.75065V5.41732H16.6667Z" fill=""/>
                            </svg>
                            Work
                          </label>

                          <label class="save-as-option">
                            <input type="radio" name="address_type_{{ address.id }}" value="others">
                            <svg
                              width="20"
                              height="20"
                              viewBox="0 0 20 20"
                              fill="none"
                              xmlns="http://www.w3.org/2000/svg"
                            >
                              <path d="M10.0001 1.66602C6.77508 1.66602 4.16675 4.27435 4.16675 7.49935C4.16675 11.8743 10.0001 18.3327 10.0001 18.3327C10.0001 18.3327 15.8334 11.8743 15.8334 7.49935C15.8334 4.27435 13.2251 1.66602 10.0001 1.66602ZM5.83341 7.49935C5.83341 5.19935 7.70008 3.33268 10.0001 3.33268C12.3001 3.33268 14.1667 5.19935 14.1667 7.49935C14.1667 9.89935 11.7667 13.491 10.0001 15.7327C8.26675 13.5077 5.83341 9.87435 5.83341 7.49935Z" fill=""/>
                              <path d="M10.0001 9.58268C11.1507 9.58268 12.0834 8.64994 12.0834 7.49935C12.0834 6.34876 11.1507 5.41602 10.0001 5.41602C8.84949 5.41602 7.91675 6.34876 7.91675 7.49935C7.91675 8.64994 8.84949 9.58268 10.0001 9.58268Z" fill=""/>
                            </svg>
                            Others
                          </label>
                        </div>
                      </div>

                      <div class="address-form-actions">
                        <button
                          type="submit"
                          class="btn-update-address btn-edit-address"
                          id="btn-edit-address-{{ address.id }}"
                          disabled
                          style="opacity: 0.5; cursor: not-allowed;"
                        >
                          Done
                        </button>
                      </div>
                    </div>

                    <input type="hidden" name="address[country]" value="India">
                  {%- endform -%}
                </div>
              {%- endfor -%}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% comment %} <script src="{{ 'main-account-page.js' | asset_url }}" defer="defer"></script> {% endcomment %}
<script>
  function desktopBred() {
    resetToOriginalState();
  }

  // Function to reset to original state (shows sidebar + account content, hides profile)
  function resetToOriginalState() {
    const ismobile = window.innerWidth <= 768;

    //desktopBred
    document.querySelector('.desk-separator').style.display = 'none';
    document.querySelector('.desk-orders').style.display = 'none';
    document.querySelector('.profile-breadcrumb-desk').style.color = '#000';
    // Common elements
    const myProfileSection = document.querySelector('.my-profile');
    const accountContent = document.querySelector('.account-content');
    const accountSidebar = document.querySelector('.account-sidebar');
    const ordersListView = document.querySelector('.orders-list-view');
    const orderDetailsView = document.querySelector('.order-details-view');
    const profileInfo = document.querySelector('.profile-info');
    const profileSection = document.querySelector('.profile-section');
    const tabContents = document.querySelectorAll('.tab-content');

    // Reset profile section
    if (myProfileSection) {
      myProfileSection.style.display = 'none';
      myProfileSection.classList.remove('active');
    }

    // Show main account content and sidebar
    if (accountContent) accountContent.style.display = 'flex';
    if (accountSidebar) accountSidebar.style.display = 'flex';

    // Show orders list view, hide details
    if (ordersListView) ordersListView.style.display = 'flex';
    if (orderDetailsView) orderDetailsView.classList.remove('active');

    // Hide all order detail containers
    const orderDetailsContainers = document.querySelectorAll('.order-details-content');
    orderDetailsContainers.forEach((container) => {
      container.style.display = 'none';
    });

    // Reset menu item active states
    const menuItems = document.querySelectorAll('.menu-item');
    menuItems.forEach((item) => item.classList.remove('active'));

    // Set "My Orders" as active
    const myOrdersItem = document.querySelector('.menu-item.identify-orders[data-tab="my-orders"]');
    if (myOrdersItem) {
      myOrdersItem.classList.add('active');
    }

    tabContents.forEach((container) => container.classList.remove('active'));

    if (tabContents.length > 0) {
      tabContents[0].classList.add('active');
    }

    // Mobile specific resets
    if (ismobile) {
      const myOrdersToggle = document.querySelector('.my-orders-toggle');
      const myProfileBack = document.querySelector('.my-profile-back');
      const profileTitle = document.querySelector('.profile-title');

      if (myOrdersToggle) myOrdersToggle.style.display = 'none';
      if (myProfileBack) myProfileBack.style.display = 'none';
      if (profileSection) profileSection.style.display = 'flex';
      if (profileInfo) profileInfo.style.display = 'flex';
      if (profileTitle) profileTitle.textContent = 'Profile';
    }
    document.querySelector('.profile-breadcrumb-desk').style.color = '#000';
  }

  // Update the existing menu item click handler to use reset function
  document.addEventListener('DOMContentLoaded', function () {
    const myOrdersItem = document.querySelector('li.menu-item.identify-orders[data-tab="my-orders"]');

    if (myOrdersItem) {
      myOrdersItem.addEventListener('click', function (event) {
        event.preventDefault();
        resetToOriginalState();
      });
    }
  });

  // Orders Pagination Implementation
  document.addEventListener('DOMContentLoaded', function () {
    const ismobile = window.innerWidth <= 768 ? true : false;

    const ORDERS_PER_PAGE = 8;
    let currentOrdersShown = ORDERS_PER_PAGE;

    // Get all order elements
    const ordersList = document.querySelector('.order-data');
    const allOrderSlides = document.querySelectorAll('.order-slide');
    const totalOrders = allOrderSlides.length;

    // Get the existing button from HTML
    const viewMoreContainer = document.querySelector('.view-more-container');
    const viewMoreBtn = document.querySelector('.view-more-orders-btn');

    // Initialize pagination only if there are more than ORDERS_PER_PAGE orders
    function initializeOrdersPagination() {
      if (totalOrders <= ORDERS_PER_PAGE) {
        // Hide the button if not needed
        if (viewMoreContainer) {
          viewMoreContainer.style.display = 'none';
        }
        return;
      }

      // Hide orders beyond the first page
      allOrderSlides.forEach((order, index) => {
        if (index >= ORDERS_PER_PAGE) {
          order.style.display = 'none';
        }
      });

      // Show the view more button
      if (viewMoreContainer) {
        viewMoreContainer.style.display = 'flex';
      }

      // Setup the button click event
      if (viewMoreBtn) {
        viewMoreBtn.addEventListener('click', function () {
          loadMoreOrders();
        });
      }
    }

    // Function to load more orders
    function loadMoreOrders() {
      const remainingOrders = totalOrders - currentOrdersShown;
      const ordersToShow = Math.min(ORDERS_PER_PAGE, remainingOrders);

      // Show next batch of orders with animation
      for (let i = currentOrdersShown; i < currentOrdersShown + ordersToShow; i++) {
        if (allOrderSlides[i]) {
          allOrderSlides[i].style.display = 'block';
          allOrderSlides[i].style.opacity = '0';
          allOrderSlides[i].style.transform = 'translateY(20px)';

          setTimeout(() => {
            allOrderSlides[i].style.transition = 'opacity 0.3s ease, transform 0.3s ease';
            allOrderSlides[i].style.opacity = '1';
            allOrderSlides[i].style.transform = 'translateY(0)';
          }, 100);
        }
      }

      currentOrdersShown += ordersToShow;

      // Hide button if all orders shown
      if (currentOrdersShown >= totalOrders) {
        const viewMoreContainer = document.querySelector('.view-more-container');
        if (viewMoreContainer) {
          viewMoreContainer.style.display = 'none';
        }
      } else {
        // Update button text
        // const viewMoreBtn = document.querySelector('.view-more-orders-btn span');
        const remaining = totalOrders - currentOrdersShown;
      }
    }

    // Reset pagination function
    function resetOrdersPagination() {
      currentOrdersShown = ORDERS_PER_PAGE;

      allOrderSlides.forEach((order, index) => {
        order.style.transition = 'none';
        if (index < ORDERS_PER_PAGE) {
          order.style.display = 'flex';
          order.style.opacity = '1';
          order.style.transform = 'translateY(0)';
        } else {
          order.style.display = 'none';
        }
      });

      const viewMoreContainer = document.querySelector('.view-more-container');
      if (viewMoreContainer && totalOrders > ORDERS_PER_PAGE) {
        viewMoreContainer.style.display = 'flex';
        const viewMoreBtn = viewMoreContainer.querySelector('.view-more-orders-btn span');
        if (viewMoreBtn) {
          const remaining = totalOrders - ORDERS_PER_PAGE;
          // viewMoreBtn.textContent = `View More Orders${remaining > 0 ? ` (${remaining} remaining)` : ''}`;
        }
      }
    }

    // Initialize pagination
    initializeOrdersPagination();

    // Online and instore toggle
    const container = document.querySelector('.online-instore-link');
    if (container) {
      container.querySelectorAll('span').forEach((span) => {
        span.addEventListener('click', function () {
          container.querySelectorAll('span').forEach((el) => el.classList.remove('active'));
          this.classList.add('active');
          setTimeout(() => resetOrdersPagination(), 100);
        });
      });
    }

    // Tab functionality
    const menuItems = document.querySelectorAll('.menu-item');
    const tabContents = document.querySelectorAll('.tab-content');
    const accountContent = document.querySelector('.account-content');

    menuItems.forEach((item) => {
      item.addEventListener('click', function () {
        const tabId = this.getAttribute('data-tab');

        // Reset desktop breadcrumbs
        document.querySelector('.desk-separator').style.display = 'none';
        document.querySelector('.desk-orders').style.display = 'none';

        // Reset mobile breadcrumbs
        document.querySelector('.mob-separator').style.display = 'inline';
        document.querySelector('.mob-orders').style.display = 'inline';
        document.querySelector('.profile-breadcrumb-mob').style.color = '#767676';

        // Remove active from all menu items
        menuItems.forEach((mi) => mi.classList.remove('active'));

        if (ismobile) {
          // Update title based on tab
          if (tabId === 'my-orders') {
            document.querySelector('.profile-title').textContent = 'My Orders';
          } else if (tabId === 'my-address') {
            document.querySelector('.profile-title').textContent = 'Saved Addresses';
          }

          document.querySelector('.profile-info').style.display = 'none';
          const asideContainer = document.querySelector('.account-sidebar');
          asideContainer.style.display = 'none';
        }

        if (tabId !== 'logout') {
          tabContents.forEach((tc) => tc.classList.remove('active'));
        }

        if (tabId === 'my-orders') {
          accountContent.classList.add('active');
          document.getElementById('my-address').style.display = 'none';
          document.querySelector('.saved-addresses-container').style.display = 'none';

          document.querySelectorAll('.address-modal').forEach((modal) => {
            modal.style.display = 'none';
          });
        } else {
          accountContent.classList.remove('active');
        }

        if (tabId == 'my-address') {
          accountContent.classList.add('active');
        } else {
          accountContent.classList.remove('active');
        }

        if (tabId == 'my-address') {
          const myProfileSection = document.querySelector('.my-profile');
          const accountContent = document.querySelector('.account-content');
          const savedAddressContainer = document.querySelector('.saved-addresses-container');
          const addressModals = document.querySelectorAll('.address-modal');

          const myOrders = document.querySelector('.tab-content');
          const orderListView = document.querySelector('.orders-list-view');
          const orderDetails = document.querySelector('.order-details-view');
          myOrders.classList.remove('active');
          orderListView.classList.remove('active');
          orderListView.style.display = 'none';
          orderDetails.classList.remove('active');

          if (savedAddressContainer) {
            savedAddressContainer.style.display = 'block';
          }

          addressModals.forEach((modal) => {
            modal.style.display = 'none';
          });

          myProfileSection.style.display = 'none';

          myProfileSection.classList.remove('active');

          accountContent.style.display = 'flex';

          if (ismobile) {
            document.querySelector('.profile-header-container').style.display = 'none';
            document.querySelector('.account-navigation-container').style.marginTop = '0px';
          }
        }

        const activeTab = document.getElementById(tabId);
        if (activeTab) {
          activeTab.style.display = 'flex';

          if (tabId === 'my-orders') {
            setTimeout(() => resetOrdersPagination(), 100);
          }
        }

        // Add active back to clicked item
        this.classList.add('active');
      });
    });

    // Order click functionality
    const orderSlides = document.querySelectorAll('.order-slide');
    const ordersListView = document.querySelector('.orders-list-view');
    const orderDetailsView = document.querySelector('.order-details-view');
    const allOrderDetails = document.querySelectorAll('.order-details-content');

    orderSlides.forEach((orderSlide) => {
      orderSlide.addEventListener('click', function () {
        if (ismobile) {
          document.querySelector('.my-orders-toggle').style.display = 'flex';
          document.querySelector('.profile-section').style.display = 'none';
        }
        document.querySelector('.desk-separator').style.display = 'inline';
        document.querySelector('.desk-orders').style.display = 'inline';
        document.querySelector('.profile-breadcrumb-desk').style.color = '#767676';

        const orderId = this.getAttribute('data-order-id');
        showOrderDetails(orderId);
        const myOrdersContainer = document.querySelector('.orders-list-view');
        myOrdersContainer.style.display = 'none';
      });
    });

    const backButtons = document.querySelectorAll('.back-to-orders-btn');
    backButtons.forEach((backBtn) => {
      backBtn.addEventListener('click', function () {
        showOrdersList();
      });
    });

    function showOrderDetails(orderId) {
      allOrderDetails.forEach((detail) => {
        detail.style.display = 'none';
      });

      const selectedOrderDetail = document.getElementById(`order-details-${orderId}`);
      if (selectedOrderDetail) {
        selectedOrderDetail.style.display = 'flex';
      }

      ordersListView.classList.remove('active');
      orderDetailsView.classList.add('active');

      setTimeout(() => {
        window.scrollTo({
          top: 0,
          behavior: 'smooth',
        });
      }, 50);
    }

    function showOrdersList() {
      allOrderDetails.forEach((detail) => {
        detail.style.display = 'none';
      });

      orderDetailsView.classList.remove('active');
      ordersListView.classList.add('active');
    }

    // Initialize - hide all order details by default
    allOrderDetails.forEach((detail) => {
      detail.style.display = 'none';
    });

    const orderTabs = document.querySelectorAll('.tab-button');
    orderTabs.forEach((tab) => {
      tab.addEventListener('click', function () {
        orderTabs.forEach((t) => t.classList.remove('active'));
        this.classList.add('active');
      });
    });
  });

  function MobileBred(props) {
    document.querySelector('.profile-breadcrumb-mob').style.color = '#000000';
    document.querySelector('.main-account-page').style.backgroundColor = '#FAFAFA';

    if (window.innerWidth <= 768) {
      document.querySelector('.my-orders-toggle').style.display = 'none';
      const btnProfileBack = document.querySelector('.my-profile-back');

      if (btnProfileBack) btnProfileBack.style.display = 'none';

      if (!props) {
        document.querySelector('.mob-separator').style.display = 'none';
        document.querySelector('.mob-orders').style.display = 'none';
      }

      if (props === 'my-orders') {
        // Show orders view
        document.querySelector('.orders-list-view').style.display = 'flex';
        document.querySelector('.account-content').style.display = 'flex';
        document.querySelector('.account-sidebar').style.display = 'none';
        document.querySelector('.profile-section').style.display = 'flex';
        document.querySelector('.profile-info').style.display = 'none';

        const mobileProfBred = document.querySelector('.my-profile');
        if (mobileProfBred) mobileProfBred.style.display = 'none';

        document.querySelector('.profile-title').textContent = 'My Orders';
      } else if (props === 'my-address') {
        // Show address view
        document.querySelector('.account-content').style.display = 'flex';
        document.querySelector('.account-sidebar').style.display = 'none';
        document.querySelector('.profile-section').style.display = 'flex';
        document.querySelector('.profile-info').style.display = 'none';

        // Make sure address tab is active
        document.querySelectorAll('.tab-content').forEach((tab) => tab.classList.remove('active'));
        document.getElementById('my-address').classList.add('active');

        const mobileProfBred = document.querySelector('.my-profile');
        if (mobileProfBred) mobileProfBred.style.display = 'none';

        document.querySelector('.profile-title').textContent = 'Saved Addresses';
      } else {
        // Show profile section
        document.querySelector('.profile-section').style.display = 'flex';
        document.querySelector('.profile-info').style.display = 'flex';
        document.querySelector('.profile-title').textContent = 'Profile';

        const orderaside = document.querySelector('.account-sidebar');
        const accountContent = document.querySelector('.account-content');
        if (orderaside) orderaside.style.display = 'flex';
        if (accountContent) accountContent.style.display = 'none';

        const mobileProfBred = document.querySelector('.my-profile');
        if (mobileProfBred) mobileProfBred.style.display = 'none';
      }

      // Hide all order details (common for all cases)
      const orderDetailsContainers = document.querySelectorAll('.order-details-content');
      orderDetailsContainers.forEach((container) => {
        container.style.display = 'none';
      });
    }
  }

  function saveAddressBack() {
    document.querySelector('.profile-header-container').style.display = 'flex';
    document.querySelector('.account-sidebar ').style.display = 'none';

    const tabContents = document.querySelectorAll('.tab-content');

    tabContents.forEach((container) => container.classList.remove('active'));

    if (tabContents.length > 0) {
      tabContents[0].classList.add('active');
    }
    MobileBred();
  }

  function handleMyOrdersClick() {
    // Get the specific li element
    const myOrdersItem = document.querySelector('li.menu-item.identify-orders[data-tab="my-orders"]');

    if (myOrdersItem) {
      myOrdersItem.addEventListener('click', function (event) {
        event.preventDefault();

        const allMenuItems = document.querySelectorAll(
          '.account-sidebar > .account-menu > .menu-item, .account-sidebar > .account-menu > a.menu-item'
        );

        allMenuItems.forEach((item) => {
          item.classList.remove('active');
        });

        const orderDetailsContainers = document.querySelectorAll('.order-details-content');
        orderDetailsContainers.forEach((container) => {
          container.style.display = 'none';
        });
        this.classList.add('active');
      });
    }
  }

  // Call the function to set up the event listener
  handleMyOrdersClick();

  // Alternative: If you want a more direct approach without wrapping in a function
  document.addEventListener('DOMContentLoaded', function () {
    const myOrdersItem = document.querySelector('li.menu-item.identify-orders[data-tab="my-orders"]');

    if (myOrdersItem) {
      myOrdersItem.addEventListener('click', function (event) {
        event.preventDefault();
        const accountContent = document.querySelector('.account-content');
        const myProfileSection = document.querySelector('.my-profile');

        myProfileSection.style.display = 'none';
        myProfileSection.classList.remove('active');
        accountContent.style.display = 'flex';

        const allMenuItems = document.querySelectorAll(
          '.account-sidebar > .account-menu > .menu-item, .account-sidebar > .account-menu > a.menu-item'
        );
        // allMenuItems.forEach((item) => item.classList.remove('active'));
        const orderDetails = document.querySelectorAll('.order-details-view');
        orderDetails.forEach((item) => item.classList.remove('active'));

        // Hide all order-details-content containers
        const orderDetailsContainers = document.querySelectorAll('.order-details-content');
        orderDetailsContainers.forEach((container) => {
          container.style.display = 'none';
        });

        // Show orders-list-view container
        const ordersListView = document.querySelector('.orders-list-view');
        if (ordersListView) {
          ordersListView.style.display = 'flex';
        }
      });
    }
  });
</script>

<!-- Example usage in your HTML - make sure these elements exist -->

{% schema %}
{
  "name": "main-account-page",
  "class": "main-account-page-parent",
  "settings": [
    {
      "type": "image_picker",
      "id": "user_profile_image",
      "label": "User Profile Image"
    },
    {
      "type": "image_picker",
      "id": "user_profile_image_mobile",
      "label": "Mobile User Profile Image"
    },
    {
      "type": "url",
      "id": "help_support_link",
      "label": "Help and Support URL"
    },
    {
      "type": "url",
      "id": "reorder_url",
      "label": "Reorder URL"
    },
    {
      "type": "url",
      "id": "return_and_exchange_url",
      "label": "Return and Exchange URL"
    },
    {
      "type": "url",
      "id": "chat_support_link",
      "label": "Chat and Support URL"
    },
    {
      "type": "url",
      "id": "terms_policies_link",
      "label": "Terms and Policies URL"
    },
    {
      "type": "image_picker",
      "id": "empty_orders_image",
      "label": "Empty Orders Image"
    },
    {
      "type": "url",
      "id": "empty_shopnow_link",
      "label": "Empty Orders Shop Now URL"
    },
    {
      "type": "url",
      "id": "track_order_link",
      "label": "Track Order URL"
    },
    {
      "type": "url",
      "id": "cancel_order_link",
      "label": "Cancel Order URL"
    }
  ],
  "presets": [
    {
      "name": "Main Account Page"
    }
  ]
}
{% endschema %}

<script>
  // Global variable to store customer notes (accessible to address type pre-selection)
  window.customerNotesDataOnLoad = '';

document.addEventListener('DOMContentLoaded', function() {
  const ismobile = window.innerWidth <=768 ? true : false;
  // Profile management variables
  let customerGenderInitial = '', customerDobInitial = '', customerGenderAfterSave = '', customerDobAfterSave = '';
  let iti; // International phone input instance

  // Track initial form values for change detection
  let initialFormValues = {
    firstName: '',
    lastName: '',
    phone: '',
    birthdate: '',
    gender: ''
  };

  // DOM elements
  const myProfileSection = document.getElementById('my-profile-section');
  const accountContent = document.querySelector('.account-content');
  const accountSidebar = document.querySelector('.account-sidebar');

  initializeGenderSelection();

  // Profile data display elements
  const firstNameDisplay = document.querySelector('.firstname > .profile-data-content');
  const lastNameDisplay = document.querySelector('.lastname > .profile-data-content');
  const contactNumberDisplay = document.querySelector('.contact-number > .profile-data-content');
  const birthdateDisplay = document.querySelector('.birthdate > .profile-data-content');
  const genderDisplay = document.querySelector('.gender > .profile-data-content');

  // Form elements
  const profileFirstName = document.getElementById('profileForm-FirstName');
  const profileLastName = document.getElementById('profileForm-LastName');
  const profilePhone = document.getElementById('profileForm-Phone');
  const profileBirthdate = document.getElementById('profileForm-Birthdate');
  const profileGender = document.getElementById('profileForm-Gender');

  // Status elements
  const profileFormErrors = document.querySelector('.profileForm-errors');
  const profileFormStatus = document.querySelector('.profileForm-status');

  // Save button (assuming it has an ID or class - adjust selector as needed)
  const saveButton = document.querySelector('[onclick="saveProfile()"]') ||
                     document.querySelector('.save-profile-btn') ||
                     document.querySelector('button[type="submit"]');

  // Gender radio buttons handling
  const genderRadios = document.querySelectorAll('input[name="gender"]');

  // Initialize international phone input (only if you want to keep it)
  function initializePhoneInput() {
    if (profilePhone && window.intlTelInput) {
      // Only initialize if you don't have the +91 prefix UI
      // Skip this if you're using the new UI design
      return;
    }
  }

  // Function to capture initial form values
  function captureInitialValues() {
    initialFormValues = {
      firstName: profileFirstName?.value?.trim() || '',
      lastName: profileLastName?.value?.trim() || '',
      phone: profilePhone?.value?.trim() || '',
      birthdate: profileBirthdate?.value?.trim() || '',
      gender: getSelectedGender() || ''
    };
  }

  // Function to get current form values
  function getCurrentFormValues() {
    return {
      firstName: profileFirstName?.value?.trim() || '',
      lastName: profileLastName?.value?.trim() || '',
      phone: profilePhone?.value?.trim() || '',
      birthdate: profileBirthdate?.value?.trim() || '',
      gender: getSelectedGender() || ''
    };
  }

  // Function to check if form has changed
  function hasFormChanged() {
    const currentValues = getCurrentFormValues();

    const changed =
      currentValues.firstName !== initialFormValues.firstName ||
      currentValues.lastName !== initialFormValues.lastName ||
      currentValues.phone !== initialFormValues.phone ||
      currentValues.birthdate !== initialFormValues.birthdate ||
      currentValues.gender !== initialFormValues.gender;

    return changed;
  }

  // Function to update save button state
  function updateSaveButtonState() {
    if (saveButton) {
      const changed = hasFormChanged();

      if (changed) {
        saveButton.disabled = false;
        saveButton.style.opacity = '1';
        saveButton.style.cursor = 'pointer';
        saveButton.classList.remove('disabled');
      } else {
        saveButton.disabled = true;
        saveButton.style.opacity = '0.5';
        saveButton.style.cursor = 'not-allowed';
        saveButton.classList.add('disabled');
      }
    }
  }

  // Add event listeners to form fields for change detection
  function addFormChangeListeners() {
    // Text input fields
    [profileFirstName, profileLastName, profilePhone, profileBirthdate].forEach(field => {
      if (field) {
        field.addEventListener('input', updateSaveButtonState);
        field.addEventListener('change', updateSaveButtonState);
      }
    });

    // Gender radio buttons
    genderRadios.forEach(radio => {
      radio.addEventListener('change', function() {
        updateGenderStyling();
        updateSaveButtonState();
      });
    });
  }

  // Simple notification functions (no animations)
  function showError(message) {
    let errorEl = document.querySelector('.profileForm-errors');
    let savingProfile = document.querySelector('.profileForm-status');
    if (!errorEl) {
      errorEl = document.createElement('div');
      errorEl.className = 'profileForm-errors';
      document.body.appendChild(errorEl);
    }

    errorEl.textContent = message;
    if (savingProfile) savingProfile.style.display = 'none';
    errorEl.style.display = 'block';

    setTimeout(() => {
      errorEl.style.display = 'none';
    }, 4000);
  }

  function showSuccess(message) {
    let successEl = document.querySelector('.profileForm-status');
    if (!successEl) {
      successEl = document.createElement('div');
      successEl.className = 'profileForm-status';
      document.body.appendChild(successEl);
    }

    successEl.style.display = 'inline-flex';

    if (message.includes('successfully') || message === '') {
      setTimeout(() => {
        successEl.style.display = 'none';
      }, 3000);
    }
  }

  // Gender handling functions with styling
  function getSelectedGender() {
    const checkedRadio = document.querySelector('input[name="gender"]:checked');
    return checkedRadio ? checkedRadio.value : '';
  }

  function setGenderRadio(gender) {
    // Remove selected class from all radio options
    const allRadioOptions = document.querySelectorAll('.radio-option');
    allRadioOptions.forEach(option => {
      option.classList.remove('selected');
    });

    // Set the radio button and add selected styling
    const genderRadios = document.querySelectorAll('input[name="gender"]');
    genderRadios.forEach(radio => {
      const isSelected = radio.value === gender.toLowerCase();
      radio.checked = isSelected;

      if (isSelected) {
        // Add selected class to the parent label
        const parentLabel = radio.closest('.radio-option');
        if (parentLabel) {
          parentLabel.classList.add('selected');
        }
      }
    });
  }

  function updateGenderStyling() {
    const allRadioOptions = document.querySelectorAll('.radio-option');

    allRadioOptions.forEach(option => {
      const radio = option.querySelector('input[type="radio"]');

      if (radio && radio.checked) {
        option.classList.add('selected');
      } else {
        option.classList.remove('selected');
      }
    });
  }

  // Add click event listeners for gender options
  function initializeGenderSelection() {
    const allRadioOptions = document.querySelectorAll('.radio-option');

    allRadioOptions.forEach(option => {
      option.addEventListener('click', function(e) {
        // Don't prevent default - let radio button work naturally
        // Update styling after the radio button state changes
        setTimeout(() => {
          updateGenderStyling();
          updateSaveButtonState();
        }, 10);
      });
    });

    // Also add direct radio button change listeners
    const genderRadios = document.querySelectorAll('input[name="gender"]');
    genderRadios.forEach(radio => {
      radio.addEventListener('change', function() {
        updateGenderStyling();
        updateSaveButtonState();
      });
    });
  }

  // Form validation functions
  function validateForm() {
    const firstName = profileFirstName?.value?.trim();
    const phone = profilePhone?.value?.trim();

    if (!firstName) {
      showError('First name is required');
      return false;
    }

    if (firstName.length < 2) {
      showError('First name must be at least 2 characters');
      return false;
    }

    if (!phone) {
      showError('Phone number is required');
      return false;
    }

    // Basic phone validation (adjust as needed)
    if (phone.length < 10) {
      showError('Please enter a valid phone number');
      return false;
    }

    return true;
  }

  // Customer data fetching functions
  async function fetchCustomerData() {
    try {
      const response = await fetch('https://script.google.com/macros/s/AKfycbzmB-H7Qbe1qo5opPhS_CnQf5uKc9zZyTRv-SVAkuQ26KF4VsLWITXjcDYcNiFraYaRyA/exec?action=getCustomerData&id={{customer.id}}');

      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }

      const result = await response.text();
      return result;
    } catch(error) {
      console.error('Error fetching customer data:', error);
      return null;
    }
  }

  async function loadMyProfileDataOnPageLoad() {
    try {
      // Use saved data if available
      if (customerDobAfterSave || customerGenderAfterSave) {
        if (birthdateDisplay && customerDobAfterSave) {
          birthdateDisplay.textContent = customerDobAfterSave;
          if (profileBirthdate) profileBirthdate.value = customerDobAfterSave;
        }
        if (genderDisplay && customerGenderAfterSave) {
          genderDisplay.textContent = customerGenderAfterSave;
          setGenderRadio(customerGenderAfterSave);
        }

        // Capture initial values after loading saved data
        setTimeout(() => {
          captureInitialValues();
          updateSaveButtonState();
        }, 100);
        return;
      }

      const data = await fetchCustomerData();

      if (data) {
        window.customerNotesDataOnLoad = JSON.parse(data);

        if (window.customerNotesDataOnLoad.note && window.customerNotesDataOnLoad.note !== 'null') {
          if (window.customerNotesDataOnLoad.note.includes('###')) {
            try {
              const start = window.customerNotesDataOnLoad.note.indexOf("###") + 3;
              const end = window.customerNotesDataOnLoad.note.lastIndexOf("###");
              const notesData = window.customerNotesDataOnLoad.note.slice(start, end);
              const customerNotes = JSON.parse(notesData);

              // Handle birth date
              if (customerNotes.dob && customerNotes.dob !== 'null' && customerNotes.dob !== '') {
                if (birthdateDisplay) birthdateDisplay.textContent = customerNotes.dob;
                if (profileBirthdate) profileBirthdate.value = customerNotes.dob;
                customerDobInitial = customerNotes.dob;
              } else {
                if (birthdateDisplay) birthdateDisplay.textContent = 'Not provided';
              }

              // Handle gender
              if (customerNotes.gender && customerNotes.gender !== 'null' && customerNotes.gender !== '') {
                if (genderDisplay) genderDisplay.textContent = customerNotes.gender;
                setGenderRadio(customerNotes.gender);
                customerGenderInitial = customerNotes.gender;
              } else {
                if (genderDisplay) genderDisplay.textContent = 'Not provided';
              }
            } catch (parseError) {
              console.error('Error parsing customer notes:', parseError);
              if (birthdateDisplay) birthdateDisplay.textContent = 'Not provided';
              if (genderDisplay) genderDisplay.textContent = 'Not provided';
            }
          } else {
            if (birthdateDisplay) birthdateDisplay.textContent = 'Not provided';
            if (genderDisplay) genderDisplay.textContent = 'Not provided';
          }
        } else {
          if (birthdateDisplay) birthdateDisplay.textContent = 'Not provided';
          if (genderDisplay) genderDisplay.textContent = 'Not provided';
        }
      }

      // Capture initial values after loading data and add event listeners
      setTimeout(() => {
        updateGenderStyling();
        captureInitialValues();
        addFormChangeListeners();
        updateSaveButtonState();
        preSelectAddressType();
        setupAddressFormHandlers();
      }, 100);

    } catch (error) {
      console.error('Error in loadMyProfileDataOnPageLoad:', error);
      if (birthdateDisplay) birthdateDisplay.textContent = 'Error loading data';
      if (genderDisplay) genderDisplay.textContent = 'Error loading data';
    }
  }

  // Update customer data function
  async function updateCustomerData() {
    try {
      const endpointUrl = 'https://script.google.com/macros/s/AKfycbzmB-H7Qbe1qo5opPhS_CnQf5uKc9zZyTRv-SVAkuQ26KF4VsLWITXjcDYcNiFraYaRyA/exec?action=customerUpdate';

      let myNote = '';
      if (!window.customerNotesDataOnLoad || window.customerNotesDataOnLoad.note === 'null' || !window.customerNotesDataOnLoad.note) {
        window.customerNotesDataOnLoad = { note: '' };
      }

      const selectedGender = getSelectedGender();

      const originalNote = window.customerNotesDataOnLoad.note || '';
      let prefix = '';
      let suffix = '';
      let parsedNote = {};
      if (originalNote.includes("###")) {
        const gap = 3;
        const startIdx = originalNote.indexOf("###");
        const contentStart = startIdx + gap;
        const endIdx = originalNote.lastIndexOf("###");
        const jsonStr = originalNote.slice(contentStart, endIdx).trim();
        try {
          parsedNote = JSON.parse(jsonStr) || {};
        } catch (e) {
          parsedNote = {};
        }
        prefix = originalNote.slice(0, startIdx);
        suffix = originalNote.slice(endIdx + gap);
      } else {
        prefix = originalNote;
      }

      // Update only DOB and gender; preserve any other existing fields (e.g., address_types)
      parsedNote.dob = profileBirthdate.value || '';
      parsedNote.gender = selectedGender || '';

      myNote = `${prefix}###${JSON.stringify(parsedNote)}###${suffix}`;

      const requestData = {
        "customer": {
          "id": {{customer.id}},
          "first_name": profileFirstName.value,
          "last_name": profileLastName.value,
          "phone": profilePhone.value,
          "note": myNote
        }
      };

      const requestOptions = {
        method: 'POST',
        body: JSON.stringify(requestData),
        redirect: 'follow'
      };

      const response = await fetch(endpointUrl, requestOptions);
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }

      const result = await response.text();
      try {
        const parsed = JSON.parse(result);
        if (parsed && parsed.note) {
          window.customerNotesDataOnLoad = window.customerNotesDataOnLoad || {};
          window.customerNotesDataOnLoad.note = parsed.note;
        }
      } catch(_) {}
      return result;
    } catch (error) {
      console.error('Error updating customer data:', error);
      throw error;
    }
  }

  // Load profile data on page load
  loadMyProfileDataOnPageLoad();

  // Global functions for HTML onclick handlers
  window.showMyProfile = function() {

    if(ismobile){
      document.querySelector('.profile-section').style.display = 'none';
      document.querySelector('.profile-info').style.display = 'none';
      document.querySelector('.my-profile-back').style.display = 'flex';
      document.querySelector('.main-account-page').style.backgroundColor = 'white';
    }

    // Reset desktop breadcrumbs
    document.querySelector('.desk-separator').style.display = 'none';
    document.querySelector('.desk-orders').style.display = 'none';

    // Hide account content and sidebar
    if (accountContent) accountContent.style.display = 'none';
    if(ismobile){
      if (accountSidebar) accountSidebar.style.display = 'none';
    }

    // Show profile section
    if (myProfileSection) {
      myProfileSection.style.display = 'flex';
      myProfileSection.classList.add('active');
      // Reload data when showing profile
      loadMyProfileDataOnPageLoad();
    }

    // Remove active state from menu items
    const menuItems = document.querySelectorAll('.menu-item');
    menuItems.forEach(item => item.classList.remove('active'));
  }

  window.saveProfile = async function() {
    // Check if form has actually changed
    if (!hasFormChanged()) {
      showError('No changes to save');
      return;
    }

    try {
      // Validate form first
      if (!validateForm()) {
        return;
      }

      // Save data
      const response = await updateCustomerData();
      const parsedResponse = JSON.parse(response);

      if (parsedResponse.hasOwnProperty('errors')) {
        throw new Error('Server validation error: ' + JSON.stringify(parsedResponse.errors));
      }

      // CRITICAL: Update the profile header name display
      const profileNameElement = document.querySelector('.profile-name');
      if (profileNameElement && profileFirstName.value && profileLastName.value) {
        profileNameElement.textContent = `${profileFirstName.value} ${profileLastName.value}`;
      }

      // Update delivery details in order sections if they exist
      const deliveryNameElements = document.querySelectorAll('.delivery-value');
      if (deliveryNameElements.length > 0 && profileFirstName.value && profileLastName.value) {
        deliveryNameElements[0].textContent = `${profileFirstName.value} ${profileLastName.value}`;
      }

      // Store updated values for future use
      customerDobAfterSave = profileBirthdate.value;
      customerGenderAfterSave = getSelectedGender();

      // Update initial values to current values (since we just saved)
      captureInitialValues();

      // Update save button state (should be disabled now since no changes)
      updateSaveButtonState();

      // Show success message
      showSuccess('Profile updated successfully');
    } catch (error) {
      console.error('Error saving profile:', error);
      showError('Failed to save profile. Please try again.');
    }
  }

  // Initialize gender selection functionality
  initializeGenderSelection();

  // Also add event listeners for when radio buttons change (fallback)
  genderRadios.forEach(radio => {
    radio.addEventListener('change', function() {
      updateGenderStyling();
      updateSaveButtonState();
    });
  });
});





// Address Management Functions
let currentEditAddressId = null;
const saveAddressContainer = document.getElementsByClassName("saved-addresses-container")
const addModal = document.getElementById('add-address-modal'); // ✅ Renamed
const editModal = document.getElementById('edit-address-modal');

function openAddAddressModal() {
  if (saveAddressContainer) saveAddressContainer[0].style.display = "none"
  if (addModal) addModal.style.display = 'block';
  setTimeout(() => {
        window.scrollTo({
          top: 0,
          behavior: 'smooth',
        });
      }, 50);
}

function closeAddAddressModal() {
  if (addModal) {
    addModal.style.display = 'none';
    if (saveAddressContainer) saveAddressContainer[0].style.display = "block"
    // document.body.style.overflow = 'auto';
  }
}

function openEditAddressModal(addressId) {
  const editForm = document.getElementById(`edit-form-${addressId}`);

  if (saveAddressContainer) saveAddressContainer[0].style.display = "none"

  if (editModal && editForm) {
    // Hide all edit forms
    document.querySelectorAll('.edit-address-form').forEach(form => {
      form.style.display = 'none';
      form.classList.remove('active');
    });

    // Show selected form
    editForm.style.display = 'block';
    editForm.classList.add('active');

    currentEditAddressId = addressId;
    editModal.style.display = 'flex';

    // Pre-select the address type for this form
    setTimeout(() => {
      preSelectAddressType();
    }, 50);

    // document.body.style.overflow = 'hidden';
  }
}

function closeEditAddressModal() {
  const editModal = document.getElementById('edit-address-modal');
  if (editModal) {
    editModal.style.display = 'none';
      if (saveAddressContainer) saveAddressContainer[0].style.display = "block"
    document.body.style.overflow = 'auto';
    currentEditAddressId = null;
  }
}

async function deleteAddress(addressId, addressUrl) {
  if (!confirm('Are you sure you want to delete this address?')) {
    return;
  }

  try {
    // Show loading state
    const addressCard = document.querySelector(`[data-address-id="${addressId}"]`);
    if (addressCard) {
      addressCard.style.opacity = '0.5';
    }

    const formData = new FormData();
    formData.append('_method', 'delete');

    const response = await fetch(addressUrl, {
      method: 'POST',
      body: formData,
      headers: {
        'X-Requested-With': 'XMLHttpRequest'
      }
    });

    if (response.ok) {
      // Animate and remove
      if (addressCard) {
        addressCard.style.transition = 'all 0.3s ease';
        addressCard.style.transform = 'scale(0.8)';
        addressCard.style.opacity = '0';

        setTimeout(() => {
          addressCard.remove();
        }, 300);
      }

    } else {
      throw new Error('Deletion failed');
    }
  } catch (error) {
    console.error('Error:', error);
    alert('Failed to delete address. Please refresh and try again.');
    // Restore the card
    const addressCard = document.querySelector(`[data-address-id="${addressId}"]`);
    if (addressCard) {
      addressCard.style.opacity = '1';
    }
  }
}

async function setAsDefault(addressId) {
  try {
    // Show loading state on the button
    const addressCard = document.querySelector(`[data-address-id="${addressId}"]`);
    const defaultBtn = addressCard?.querySelector('.default-btn');

    if (defaultBtn) {
      defaultBtn.disabled = true;
      defaultBtn.textContent = 'Saving...';
      defaultBtn.style.opacity = '0.6';
    }

    // Find the form for this address
    const form = document.querySelector(`form[action*="${addressId}"]`);

    if (!form) {
      throw new Error('Form not found');
    }

    // Create FormData and set default to true
    const formData = new FormData(form);

    // Make sure the default checkbox is checked in the FormData
    formData.set('address[default]', '1');

    // Submit via AJAX
    const response = await fetch(form.action, {
      method: 'POST',
      body: formData,
      headers: {
        'X-Requested-With': 'XMLHttpRequest'
      }
    });

    if (response.ok) {
      // Success! Reload the addresses section without page reload
      await reloadAddressesSection();

    } else {
      throw new Error('Failed to set default address');
    }

  } catch (error) {
    console.error('Error setting default address:', error);
    alert('Failed to set default address. Please try again.');

    // Restore button state on error
    const addressCard = document.querySelector(`[data-address-id="${addressId}"]`);
    const defaultBtn = addressCard?.querySelector('.default-btn');

    if (defaultBtn) {
      defaultBtn.disabled = false;
      defaultBtn.textContent = 'Set as default';
      defaultBtn.style.opacity = '1';
    }
  }
}

// Save As option handling - using event delegation to prevent duplicate listeners
let saveAsHandlersSetup = false;

function setupSaveAsOptionHandlers() {
  if (saveAsHandlersSetup) {
    return;
  }

  let eventCount = 1;

document.addEventListener('click', function(e) {

  if(eventCount == 1){
    eventCount++;
    return 
  }else{
    eventCount = 1
  }


    const option = e.target.closest('.save-as-option');
    if (!option) return;

    const radio = option.querySelector('input[type="radio"]');
    const container = option.closest('.save-as-options');

    console.log('Save-as option clicked - radio:', radio ? radio.name + '=' + radio.value : 'not found');

    container.querySelectorAll('.save-as-option').forEach(opt => {
      opt.classList.remove('active');
    });

    option.classList.add('active');
    if (radio) {
      radio.checked = true;

      const form = option.closest('form');
      if (form) {
        form.dataset.selectedAddressType = radio.value;
      }

      const changeEvent = new Event('change', { bubbles: true });
      radio.dispatchEvent(changeEvent);
    }
    if(option.classList.contains('addOthers')){
        toggleAddOther()
    }
    
  });

function toggleAddOther() {
  const otherInput = document.querySelector('.addinputForOther');
  const homeOption = document.querySelector('.save-as-option.addhome');
  const officeOption = document.querySelector('.save-as-option.addoffice');
  const othersOption = document.querySelector('.save-as-option.addothers');
    const closeIcon = document.querySelector('.closeIconOther');
  if (otherInput.classList.contains('hide')) {
    otherInput.classList.remove('hide');
    closeIcon.classList.remove("hide")
    homeOption.classList.add('hide');
    officeOption.classList.add('hide');
    setTimeout(() => otherInput.focus(), 100);
  } else {
    otherInput.classList.add('hide');
    closeIcon.classList.add('hide');
    homeOption.classList.remove('hide');
    officeOption.classList.remove('hide');
    otherInput.value = '';
    const othersRadio = othersOption.querySelector('input[type="radio"]');
    if (othersRadio) othersRadio.value = 'others';
  }
}

  document.addEventListener('change', function(e) {
    const changedRadio = e.target.closest('input[type="radio"][name^="address_type"]');
    if (!changedRadio) return;

    const form = changedRadio.closest('form');
    const name = changedRadio.name || '';
    const value = changedRadio.value;

    let addressId = null;
    const nameMatch = name.match(/^address_type_(\d+)$/);
    if (nameMatch) {
      addressId = nameMatch[1];
    } else if (form) {
      const formAction = form.getAttribute('action') || '';
      const idMatch = formAction.match(/\/(\d+)\.json/);
      addressId = idMatch ? idMatch[1] : null;
    }

    if (form) form.dataset.selectedAddressType = value;

    if (addressId) {
      window._addressTypeSaveTimers = window._addressTypeSaveTimers || {};
      if (window._addressTypeSaveTimers[addressId]) {
        clearTimeout(window._addressTypeSaveTimers[addressId]);
      }
      window._addressTypeSaveTimers[addressId] = setTimeout(() => {
        const promise = saveAddressIdToNote(addressId, value);
        if (form) {
          const formRef = form;
          Promise.resolve(promise).then(() => {
            formRef.dataset.lastAutosaveType = value;
            formRef.dataset.lastAutosaveAt = String(Date.now());
          }).catch(() => {});
        }
      }, 250);
    } else {
      console.log('Autosave skipped: no addressId (likely Add Address form before creation)');
    }
  });


  saveAsHandlersSetup = true;
}

document.addEventListener('DOMContentLoaded', function() {
  setupSaveAsOptionHandlers();

});

// Handle menu item click for "Saved Addresses"
document.addEventListener('DOMContentLoaded', function() {
  const savedAddressMenuItem = document.querySelector('.menu-item[data-tab="my-address"]');

  if (savedAddressMenuItem) {
    savedAddressMenuItem.addEventListener('click', function() {
      const ismobile = window.innerWidth <= 768;

      // Remove active from all menu items
      document.querySelectorAll('.menu-item').forEach(item => {
        item.classList.remove('active');
      });

      // Add active to saved addresses
      this.classList.add('active');

      // Hide all tab contents
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });

      // Show saved addresses tab
      const myAddressTab = document.getElementById('my-address');
      if (myAddressTab) {
        myAddressTab.classList.add('active');
      }

      // Mobile specific handling
      if (ismobile) {
        document.querySelector('.profile-title').textContent = 'Saved Addresses';
        document.querySelector('.profile-info').style.display = 'none';
        const asideContainer = document.querySelector('.account-sidebar');
        if (asideContainer) {
          asideContainer.style.display = 'none';
        }
      }
    });
  }
});

async function saveAddressIdToNote(addressId, addressType) {
  try {

    const endpointUrl = 'https://script.google.com/macros/s/AKfycbzmB-H7Qbe1qo5opPhS_CnQf5uKc9zZyTRv-SVAkuQ26KF4VsLWITXjcDYcNiFraYaRyA/exec?action=customerUpdate';

    let myNote = '';
    try {
      if (window.customerNotesDataOnLoad && window.customerNotesDataOnLoad.note && window.customerNotesDataOnLoad.note !== 'null') {
        myNote = window.customerNotesDataOnLoad.note;
      }
    } catch (e) {
    }

    let dobValue = '';
    let genderValue = '';
    let existingAddressTypes = [];

    if (myNote.includes("###")) {
      const gap = 3;
      const startIndex = myNote.indexOf("###") + gap;
      const endIndex = myNote.lastIndexOf("###");
      const noteValue = myNote.slice(startIndex, endIndex);

      try {
        const parsedNote = JSON.parse(noteValue);
        dobValue = parsedNote.dob || '';
        genderValue = parsedNote.gender || '';

        if (parsedNote.address_types && Array.isArray(parsedNote.address_types)) {
          existingAddressTypes = parsedNote.address_types;
        } else if (parsedNote.address_type && typeof parsedNote.address_type === 'object') {
          existingAddressTypes = [parsedNote.address_type];
        }
      } catch (e) {
        console.error('Error parsing existing note:', e);
      }

      myNote = '';
    }

    const addressTypeUppercase = addressType.toUpperCase();

    let addressTypes = existingAddressTypes.length > 0 ? existingAddressTypes : [];

    const existingIndex = addressTypes.findIndex(a => a.address_id === addressId);
    if (existingIndex >= 0) {
      addressTypes[existingIndex].address_type = addressTypeUppercase;
    } else {
      addressTypes.push({
        address_id: addressId,
        address_type: addressTypeUppercase
      });
    }

    myNote = `###
{
  "dob": "${dobValue}",
  "gender": "${genderValue}",
  "address_types": ${JSON.stringify(addressTypes, null, 2)}
}
###`;

    const requestData = {
      "customer": {
        "id": {{customer.id}},
        "note": myNote
      }
    };

    const requestOptions = {
      method: 'POST',
      body: JSON.stringify(requestData),
      redirect: 'follow'
    };

    const response = await fetch(endpointUrl, requestOptions);
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }

    const text = await response.text();
    try {
      const parsed = JSON.parse(text);
      if (parsed && parsed.note) {
        window.customerNotesDataOnLoad = window.customerNotesDataOnLoad || {};
        window.customerNotesDataOnLoad.note = parsed.note;
      }
    } catch(_) {}
    return text;
  } catch (error) {
    console.error('[AddressType] error', error);
  }
}

function preSelectAddressType() {
  try {
    if (typeof window.customerNotesDataOnLoad === 'undefined' || !window.customerNotesDataOnLoad) {
      return;
    }

    const noteData = window.customerNotesDataOnLoad.note;
    if (!noteData || noteData === 'null') return;

    let parsedNote = {};

    if (noteData.includes('###')) {
      const gap = 3;
      const startIndex = noteData.indexOf('###') + gap;
      const endIndex = noteData.lastIndexOf('###');
      const noteValue = noteData.slice(startIndex, endIndex).trim();

      try {
        parsedNote = JSON.parse(noteValue);
      } catch (e) {
        console.error('Error parsing note:', e);
        return;
      }
    }

    if (parsedNote.address_types && Array.isArray(parsedNote.address_types)) {

      parsedNote.address_types.forEach(addressData => {
        const savedAddressId = addressData.address_id;
        const savedAddressType = addressData.address_type.toLowerCase();

        console.log('Pre-selecting address type:', savedAddressType, 'for address ID:', savedAddressId);

        const radioButton = document.querySelector(`input[name="address_type_${savedAddressId}"][value="${savedAddressType}"]`);
        if (radioButton) {
          radioButton.checked = true;

          const label = radioButton.closest('.save-as-option');
          if (label) {
            label.parentElement.querySelectorAll('.save-as-option').forEach(opt => {
              opt.classList.remove('active');
            });
            label.classList.add('active');
          }

        }
      });
    }
    else if (parsedNote.address_type && parsedNote.address_type.address_id && parsedNote.address_type.address_type) {
      const savedAddressId = parsedNote.address_type.address_id;
      const savedAddressType = parsedNote.address_type.address_type.toLowerCase();

      const radioButton = document.querySelector(`input[name="address_type_${savedAddressId}"][value="${savedAddressType}"]`);
      if (radioButton) {
        radioButton.checked = true;

        const label = radioButton.closest('.save-as-option');
        if (label) {
          label.parentElement.querySelectorAll('.save-as-option').forEach(opt => {
            opt.classList.remove('active');
          });
          label.classList.add('active');
        }

      }
    }
  } catch (error) {
    console.error('Error in preSelectAddressType:', error);
  }
}

function setupAddressFormHandlers() {
  try {
    document.addEventListener('submit', function(e) {
      const form = e.target;
      const formAction = form.getAttribute('action');

      if (!formAction || !formAction.includes('customer_address')) {
        return;
      }

      const submitBtn = form.querySelector('.btn-update-address');
      if (submitBtn) {
        submitBtn.disabled = true;
        submitBtn.textContent = 'Updating...';
      }
      const addressIdMatch = formAction.match(/\/(\d+)\.json/);
      const addressId = addressIdMatch ? addressIdMatch[1] : null;

      const allRadios = form.querySelectorAll('input[type="radio"][name*="address_type"]');
      let addressType = form.dataset.selectedAddressType;

      if (!addressType) {
        let addressTypeRadio = form.querySelector('input[name="address_type"]:checked');

        if (!addressTypeRadio && addressId) {
          addressTypeRadio = form.querySelector(`input[name="address_type_${addressId}"]:checked`);
        }

        if (!addressTypeRadio) {
          addressTypeRadio = form.querySelector('input[type="radio"]:checked');
        }

        if (!addressTypeRadio) {
          for (const radio of allRadios) {
            if (radio.checked) {
              addressTypeRadio = radio;
              break;
            }
          }
        }

        if (!addressTypeRadio) {
          addressTypeRadio = form.querySelector('input[type="radio"][checked]');
        }

        if (!addressTypeRadio) {
          const allFormRadios = form.querySelectorAll('input[type="radio"]');
          for (const radio of allFormRadios) {
            if (radio.name && radio.name.includes('address_type') && radio.checked) {
              addressTypeRadio = radio;
              break;
            }
          }
        }

        addressType = addressTypeRadio ? addressTypeRadio.value : 'work';
      }

      if (!addressType) {
        addressType = 'work';
      }


      if (addressId) {
        const lastAt = parseInt(form.dataset.lastAutosaveAt || '0', 10);
        const lastType = form.dataset.lastAutosaveType || '';
        const recentlySaved = lastType === addressType && (Date.now() - lastAt) < 2000;

        if (!recentlySaved) {
          saveAddressIdToNote(addressId, addressType);
        }
      } else {
      }
    }, true); // Use capture phase to catch all submissions
  } catch (error) {
    console.error('Error in setupAddressFormHandlers:', error);
  }
}

document.addEventListener('DOMContentLoaded', function() {

  // ============================================
  // ADD ADDRESS MODAL VALIDATION
  // ============================================

  const addAddressForm = document.querySelector('#add-address-modal form');
  const btnAddAddress = document.getElementById('btn-add-address');

  // Required fields for add address
  const addRequiredFields = {
    'AddressFirstNameNew': {
      validate: (value) => {
        if (!value || value.trim().length === 0) return 'Receiver\'s name is required';
        if (value.trim().length < 2) return 'Name must be at least 2 characters';
        return null;
      }
    },
    'AddressPhoneNew': {
      validate: (value) => {
        if (!value || value.trim().length === 0){
          document.querySelector('.addPhone').innerHTML= "0000 0000 00";
          return 'Phone number is required';
        } 
        const phoneRegex = /^[0-9]{10}$/;
        const cleanPhone = value.replace(/[\s\-\+]/g, '').slice(-10);
        if (!phoneRegex.test(cleanPhone)) {
          document.querySelector('.addPhone').innerHTML= "0000 0000 00";
          return 'Please enter a valid 10-digit phone number';
        }
        document.querySelector('.addPhone').innerHTML= value;
        return null;
      }
    },
    'AddressAddress1New': {
      validate: (value) => {
        if (!value || value.trim().length === 0) return 'Address line 1 is required';
        if (value.trim().length < 5) return 'Address must be at least 5 characters';
        return null;
      }
    },
    'AddressZipNew': {
      validate: (value) => {
        if (!value || value.trim().length === 0) return 'Pincode is required';
        const pincodeRegex = /^[0-9]{6}$/;
        if (!pincodeRegex.test(value)) return 'Please enter a valid 6-digit pincode';
        return null;
      }
    }
  };

  // Show error message
  function showAddressError(fieldId, message) {
    const errorDiv = document.getElementById(`error-${fieldId}`);
    if (errorDiv) {
      errorDiv.textContent = message;
      errorDiv.style.display = 'block';
    }

    // Add error styling to input
    const input = document.getElementById(fieldId);
    if (input) {
      input.style.borderColor = 'red';
    }
    if (fieldId.includes('Phone')) {
      const helperText = input.closest('.address-form-group')?.querySelector('.form-helper-text');
      if (helperText) {
        helperText.style.display = 'none';
      }
    }
  }

  // Hide error message
function hideAddressError(fieldId) {
  const errorDiv = document.getElementById(`error-${fieldId}`);
  if (errorDiv) {
    errorDiv.style.display = 'none';
  }

  // Remove error styling from input
  const input = document.getElementById(fieldId);
  if (input) {
    input.style.borderColor = '';

    // Show helper text again if this is a phone field
    if (fieldId.includes('Phone')) {
      const helperText = input.closest('.address-form-group')?.querySelector('.form-helper-text');
      if (helperText) {
        helperText.style.display = 'block';
      }
    }
  }
}

  // Validate single field
  function validateAddField(fieldId) {
    const input = document.getElementById(fieldId);
    if (!input) return true;

    const fieldConfig = addRequiredFields[fieldId];
    if (!fieldConfig) return true;

    const error = fieldConfig.validate(input.value);

    if (error) {
      showAddressError(fieldId, error);
      return false;
    } else {
      hideAddressError(fieldId);
      return true;
    }
  }

  // Check if all required fields are filled and valid
  function checkAddAddressFormValidity() {
    let allValid = true;

    for (const fieldId in addRequiredFields) {
      const input = document.getElementById(fieldId);
      if (input && input.disabled) continue;

      const error = addRequiredFields[fieldId].validate(input.value);
      if (error) {
        allValid = false;
      }
    }

    return allValid;
  }

  // Update add address button state
  function updateAddAddressButtonState() {
    const isValid = checkAddAddressFormValidity();

    if (btnAddAddress) {
      if (isValid) {
        btnAddAddress.disabled = false;
        btnAddAddress.style.opacity = '1';
        btnAddAddress.style.cursor = 'pointer';
      } else {
        btnAddAddress.disabled = true;
        btnAddAddress.style.opacity = '0.5';
        btnAddAddress.style.cursor = 'not-allowed';
      }
    }
  }

  // Add event listeners to add address form fields
  for (const fieldId in addRequiredFields) {
    const input = document.getElementById(fieldId);
    if (input) {
      // Validate on blur
      input.addEventListener('blur', function() {
        validateAddField(fieldId);
        updateAddAddressButtonState();
      });

      // Update button state on input
      input.addEventListener('input', function() {
        // Clear error when user starts typing
        if (this.value.trim().length > 0) {
          hideAddressError(fieldId);
        }
        updateAddAddressButtonState();
      });
    }
  }

  // ============================================
  // ⭐ CHANGED: Validate form on submit - NO PAGE RELOAD
  // ============================================
  if (addAddressForm) {
    addAddressForm.addEventListener('submit', async function(e) {
      e.preventDefault(); // ← Prevents page reload

      let hasErrors = false;

      // Validate all required fields
      for (const fieldId in addRequiredFields) {
        if (!validateAddField(fieldId)) {
          hasErrors = true;
        }
      }

      if (hasErrors) {
        return false;
      }

      // Show loading state
      const submitBtn = document.getElementById('btn-add-address');
      const originalText = submitBtn.textContent;
      submitBtn.disabled = true;
      submitBtn.style.opacity = '0.6';

      try {
        // Get form data
        const formData = new FormData(this);

        // Submit via AJAX
        const response = await fetch(this.action, {
          method: 'POST',
          body: formData,
          headers: {
            'X-Requested-With': 'XMLHttpRequest'
          }
        });

        if (response.ok) {
          // Reload just the addresses section
          await reloadAddressesSection();

          // Close modal
          closeAddAddressModal();

          // Reset form
          this.reset();
          updateAddAddressButtonState(); // Reset button state

        } else {
          throw new Error('Failed to add address');
        }

      } catch (error) {
        console.error('Error adding address:', error);
        alert('Failed to add address. Please try again.');

        // Restore button
        submitBtn.disabled = false;
        submitBtn.textContent = originalText;
        submitBtn.style.opacity = '1';
      }
    });
  }

  // ============================================
  // EDIT ADDRESS MODAL VALIDATION
  // ============================================

  // Store initial values for each edit form
  const editFormInitialValues = {};

  // Initialize edit form tracking
  function initializeEditForm(addressId) {
    const form = document.getElementById(`edit-form-${addressId}`);
    if (!form) return;

    const inputs = form.querySelectorAll('input[data-initial-value]');
    const initialValues = {};

    inputs.forEach(input => {
      initialValues[input.id] = input.getAttribute('data-initial-value') || '';
    });

    const radioButtons = form.querySelectorAll('input[type="radio"][name*="address_type"]');
    radioButtons.forEach(radio => {
      if (radio.checked) {
        radio.setAttribute('data-initial-checked', 'true');
        console.log('Radio button initial state - name:', radio.name, 'value:', radio.value, 'checked: true');
      } else {
        radio.setAttribute('data-initial-checked', 'false');
      }
    });

    editFormInitialValues[addressId] = initialValues;
  }

  // Ensure global access for other scripts
  window.initializeEditForm = initializeEditForm;


  // Check if edit form has changes
  function hasEditFormChanged(addressId) {
    const form = document.getElementById(`edit-form-${addressId}`);
    if (!form) return false;

    const inputs = form.querySelectorAll('input[data-initial-value]');

    for (const input of inputs) {
      const initialValue = editFormInitialValues[addressId]?.[input.id] || '';
      const currentValue = input.value || '';

      if (initialValue !== currentValue) {
        console.log('Form changed - field:', input.id, 'initial:', initialValue, 'current:', currentValue);
        return true;
      }
    }

    const radioButtons = form.querySelectorAll('input[type="radio"][name*="address_type"]');
    for (const radio of radioButtons) {
      if (radio.checked) {
        const initialChecked = radio.getAttribute('data-initial-checked') === 'true';
        if (radio.checked !== initialChecked) {
          console.log('Radio button changed - name:', radio.name, 'value:', radio.value, 'checked:', radio.checked);
          return true;
        }
      }
    }

    return false;
  }

  // Validate edit form required fields
  function validateEditField(fieldId, addressId) {
    const input = document.getElementById(fieldId);
    if (!input) return true;

    let error = null;

    // Determine which validation to use based on field name
    if (fieldId.includes('FirstName')) {
      const value = input.value;
      if (!value || value.trim().length === 0) {
        error = 'Receiver\'s name is required';
      } else if (value.trim().length < 2) {
        error = 'Name must be at least 2 characters';
      }
    } else if (fieldId.includes('Phone')) {
      const value = input.value;
      if (!value || value.trim().length === 0) {
        error = 'Phone number is required';
        document.querySelector('.editPhone').innerHTML = "0000 0000 00"
      } else {
        const phoneRegex = /^[0-9]{10}$/;
        const cleanPhone = value.replace(/[\s\-\+]/g, '').slice(-10);
        if (!phoneRegex.test(cleanPhone)) {
          error = 'Please enter a valid 10-digit phone number';
          document.querySelector('.editPhone').innerHTML = "0000 0000 00"
        }
        document.querySelector('.editPhone').innerHTML = value;
      }
    } else if (fieldId.includes('Address1')) {
      const value = input.value;
      if (!value || value.trim().length === 0) {
        error = 'Address line 1 is required';
      } else if (value.trim().length < 5) {
        error = 'Address must be at least 5 characters';
      }
    } else if (fieldId.includes('Zip')) {
      const value = input.value;
      if (!value || value.trim().length === 0) {
        error = 'Pincode is required';
      } else {
        const pincodeRegex = /^[0-9]{6}$/;
        if (!pincodeRegex.test(value)) {
          error = 'Please enter a valid 6-digit pincode';
        }
      }
    }

    if (error) {
      showAddressError(fieldId, error);
      return false;
    } else {
      hideAddressError(fieldId);
      return true;
    }
  }

  // Check if edit form is valid
  function checkEditFormValidity(addressId) {
    const form = document.getElementById(`edit-form-${addressId}`);
    if (!form) return false;

    const requiredInputs = form.querySelectorAll('input[required]');
    let allValid = true;

    requiredInputs.forEach(input => {
      if (input.disabled) {
        return;
      }

      if (!validateEditField(input.id, addressId)) {
        allValid = false;
      }
    });

    return allValid;
  }

  // Update edit button state
function updateEditButtonState(addressId) {
  const button = document.getElementById(`btn-edit-address-${addressId}`);
  if (!button) {
    console.log('Button not found for address:', addressId);
    return;
  }

  const hasChanged = hasEditFormChanged(addressId);
  const isValid = checkEditFormValidity(addressId);

  console.log('Button state check - Changed:', hasChanged, 'Valid:', isValid);

  if (hasChanged && isValid) {
    button.disabled = false;
    button.style.opacity = '1';
    button.style.cursor = 'pointer';
    button.classList.remove('disabled');
  } else {
    button.disabled = true;
    button.style.opacity = '0.5';
    button.style.cursor = 'not-allowed';
    button.classList.add('disabled');
  }
}

// Ensure global access for other scripts
window.updateEditButtonState = updateEditButtonState;


// Set up edit form listeners - UNCOMMENTED AND FIXED
window.setupEditFormListeners = function(addressId) {
  const formContainer = document.getElementById(`edit-form-${addressId}`);
  if (!formContainer) {
    console.error('Form container not found:', addressId);
    return;
  }

  // Remove old listeners by cloning
  const newFormContainer = formContainer.cloneNode(true);
  formContainer.parentNode.replaceChild(newFormContainer, formContainer);

  // Work with fresh container
  const freshFormContainer = document.getElementById(`edit-form-${addressId}`);
  if (!freshFormContainer) return;

  const inputs = freshFormContainer.querySelectorAll('input[type="text"], input[type="tel"], input[type="checkbox"], input[type="radio"]');

  console.log('Setting up listeners for', inputs.length, 'inputs');

  inputs.forEach(input => {
    // Validate on blur
    input.addEventListener('blur', function() {
      if (input.id.includes('FirstName') ||
          input.id.includes('LastName') || 
          input.id.includes('Phone') ||
          input.id.includes('Address1') ||
          input.id.includes('Zip')) {
        validateEditField(input.id, addressId);
      }
      updateEditButtonState(addressId);
    });

    // Update button state on input (THIS IS CRITICAL)
    input.addEventListener('input', function() {
      console.log('Input changed:', this.id, this.value);

      // Clear error when user starts typing
      if (this.value.trim().length > 0) {
        hideAddressError(input.id);
      }

      // Update button state immediately
      updateEditButtonState(addressId);
    });

    // Also listen for change events (for checkboxes/radios)
    input.addEventListener('change', function() {
      console.log('Change event:', this.id);
      updateEditButtonState(addressId);
    });
  });

	  // Re-attach pincode listeners for the fresh cloned form
	  setupPincodeField(
	    `AddressZip_${addressId}`,
	    `AddressCity_${addressId}`,
	    `AddressProvince_${addressId}`,
	    null
	  );


  // Find the actual form element inside the container
  const actualForm = freshFormContainer.querySelector('form');
  if (!actualForm) {
    console.error('Could not find form element inside edit-form-' + addressId);
    return;
  }

  // Attach submit listener
  actualForm.addEventListener('submit', async function(e) {
    e.preventDefault();

    let hasErrors = false;

    const fieldsToValidate = [
      `AddressFirstName_${addressId}`,
      `AddressPhone_${addressId}`,
      `AddressAddress1_${addressId}`,
      `AddressZip_${addressId}`
    ];

    fieldsToValidate.forEach(fieldId => {
      if (!validateEditField(fieldId, addressId)) {
        hasErrors = true;
      }
    });

    if (hasErrors) {
      return false;
    }

    // Show loading state
    const submitBtn = document.getElementById(`btn-edit-address-${addressId}`);
    const originalText = submitBtn.textContent;
    submitBtn.disabled = true;
    submitBtn.textContent = 'Updating...';
    submitBtn.style.opacity = '0.6';

    try {
      const formData = new FormData(this);


      // Ensure disabled auto-populated fields are submitted
      try {
        const cityEl = document.getElementById(`AddressCity_${addressId}`);
        const provinceEl = document.getElementById(`AddressProvince_${addressId}`);
        if (cityEl) {
          formData.set('address[city]', cityEl.value || '');
        }
        if (provinceEl) {
          formData.set('address[province]', provinceEl.value || '');
        }
      } catch (e) {
        console.warn('Could not set city/province into FormData:', e);
      }

      const response = await fetch(this.action, {
        method: 'POST',
        body: formData,
        headers: {
          'X-Requested-With': 'XMLHttpRequest'
        }
      });

      if (response.ok) {
        await reloadAddressesSection();
        closeEditAddressModal();
      } else {
        throw new Error('Update failed');
      }

    } catch (error) {
      console.error('Error updating address:', error);
      alert('Failed to update address. Please try again.');
      submitBtn.disabled = false;
      submitBtn.textContent = originalText;
      submitBtn.style.opacity = '1';
    }
  });

  console.log('Listeners setup complete for address:', addressId);
}

// Initialize all edit forms on page load
  document.querySelectorAll('[id^="edit-form-"]').forEach(form => {
    const addressId = form.id.replace('edit-form-', '');
    if (typeof initializeEditForm === 'function') { initializeEditForm(addressId); } else { console.warn('initializeEditForm is not available'); }
    window.setupEditFormListeners(addressId);
  });

 // Override openEditAddressModal to reinitialize form
const originalOpenEditAddressModal = window.openEditAddressModal;
window.openEditAddressModal = function(addressId) {
  if (originalOpenEditAddressModal) {
    originalOpenEditAddressModal(addressId);
  }

  // Reinitialize the form
  setTimeout(() => {
    if (typeof initializeEditForm === 'function') { initializeEditForm(addressId); } else { console.warn('initializeEditForm is not available'); }
    window.setupEditFormListeners(addressId);  // ⭐ CHANGED
    updateEditButtonState(addressId);
  }, 100);
};

  // Reset add form when modal opens
  const originalOpenAddAddressModal = window.openAddAddressModal;
  window.openAddAddressModal = function() {
    if (originalOpenAddAddressModal) {
      originalOpenAddAddressModal();
    }

    // Reset form
    if (addAddressForm) {
      addAddressForm.reset();
    }

    // Clear all errors
    for (const fieldId in addRequiredFields) {
      hideAddressError(fieldId);
    }

    // Update button state
    updateAddAddressButtonState();
  };

});

// ============================================
// ⭐ NEW FUNCTION: RELOAD ADDRESSES SECTION WITHOUT PAGE RELOAD
// ============================================
async function reloadAddressesSection() {
  try {
    // Fetch the current page
    const response = await fetch(window.location.href, {
      headers: {
        'X-Requested-With': 'XMLHttpRequest'
      }
    });

    const html = await response.text();
    const parser = new DOMParser();
    const doc = parser.parseFromString(html, 'text/html');

    // Get the updated addresses grid
    const newAddressesGrid = doc.querySelector('.addresses-grid');
    const currentAddressesGrid = document.querySelector('.addresses-grid');

    if (newAddressesGrid && currentAddressesGrid) {
      // Replace with animation
      currentAddressesGrid.style.opacity = '0';
      currentAddressesGrid.style.transition = 'opacity 0.3s ease';

      setTimeout(() => {
        currentAddressesGrid.innerHTML = newAddressesGrid.innerHTML;
        currentAddressesGrid.style.opacity = '1';

        reinitializeAddressElements();
      }, 300);
    }

  } catch (error) {
    console.error('Error reloading addresses:', error);
    // Fallback: reload the page
    window.location.reload();
  }
}

// ============================================
// ⭐ FIXED: RELOAD ADDRESSES SECTION WITHOUT PAGE RELOAD
// ============================================
async function reloadAddressesSection() {
  try {
    // Fetch the current page
    const response = await fetch(window.location.href, {
      headers: {
        'X-Requested-With': 'XMLHttpRequest'
      }
    });

    const html = await response.text();
    const parser = new DOMParser();
    const doc = parser.parseFromString(html, 'text/html');

    // Get the updated addresses grid
    const newAddressesGrid = doc.querySelector('.addresses-grid');
    const currentAddressesGrid = document.querySelector('.addresses-grid');

    // ⭐ CRITICAL: Also get the updated edit forms container
    const newEditFormsContainer = doc.querySelector('#edit-address-form-container');
    const currentEditFormsContainer = document.querySelector('#edit-address-form-container');

    if (newAddressesGrid && currentAddressesGrid) {
      // Replace addresses grid with animation
      currentAddressesGrid.style.opacity = '0';
      currentAddressesGrid.style.transition = 'opacity 0.3s ease';

      setTimeout(() => {
        currentAddressesGrid.innerHTML = newAddressesGrid.innerHTML;
        currentAddressesGrid.style.opacity = '1';

        // ⭐ CRITICAL: Also update the edit forms container
        if (newEditFormsContainer && currentEditFormsContainer) {
          currentEditFormsContainer.innerHTML = newEditFormsContainer.innerHTML;
          console.log('Edit forms container updated'); // Debug log
        } else {
          console.error('Could not find edit forms container');
        }

        // Reinitialize all address-related functionality
        reinitializeAddressElements();
      }, 300);
    }

  } catch (error) {
    console.error('Error reloading addresses:', error);
    // Fallback: reload the page
    window.location.reload();
  }
}

// ============================================
// ⭐ IMPROVED: REINITIALIZE ADDRESS ELEMENTS
// ============================================
function reinitializeAddressElements() {
  console.log('Reinitializing address elements...');

  // Re-attach click handlers for edit buttons
  document.querySelectorAll('.edit-btn').forEach(btn => {
    btn.removeAttribute('onclick');
    btn.onclick = function(e) {
      e.preventDefault();
      const addressCard = this.closest('.address-card');
      const addressId = addressCard.getAttribute('data-address-id');
      openEditAddressModal(addressId);
    };
  });

  // Re-attach click handlers for remove buttons
  document.querySelectorAll('.remove-btn').forEach(btn => {
    btn.removeAttribute('onclick');
    btn.onclick = function(e) {
      e.preventDefault();
      const addressCard = this.closest('.address-card');
      const addressId = addressCard.getAttribute('data-address-id');
      const addressUrl = `/account/addresses/${addressId}`;
      deleteAddress(addressId, addressUrl);
    };
  });

  // Re-attach click handlers for remove buttons
  document.querySelectorAll('.remove-btn').forEach(btn => {
    btn.removeAttribute('onclick');

    btn.onclick = function(e) {
      e.preventDefault();
      const addressCard = this.closest('.address-card');
      const addressId = addressCard.getAttribute('data-address-id');
      const addressUrl = `/account/addresses/${addressId}`;
      deleteAddress(addressId, addressUrl);
    };
  });

  // Re-attach click handlers for set default buttons
  document.querySelectorAll('.default-btn').forEach(btn => {
    btn.removeAttribute('onclick');
    btn.onclick = async function(e) {
      e.preventDefault();
      e.stopPropagation();
      const addressCard = this.closest('.address-card');
      const addressId = addressCard.getAttribute('data-address-id');
      await setAsDefault(addressId);
    };
  });

  // Re-initialize all edit forms
  const editForms = document.querySelectorAll('[id^="edit-form-"]');
  console.log('Found edit forms:', editForms.length); // Debug log

  editForms.forEach(form => {
    const addressId = form.id.replace('edit-form-', '');
    console.log('Initializing form for address:', addressId); // Debug log

    // Initialize form tracking
    const inputs = form.querySelectorAll('input[data-initial-value]');
    const initialValues = {};

    inputs.forEach(input => {
      initialValues[input.id] = input.getAttribute('data-initial-value') || '';
    });

    window.editFormInitialValues[addressId] = initialValues;

    // Setup listeners
    window.setupEditFormListeners(addressId);
  });

  // Re-setup pincode fields for all edit forms
  document.querySelectorAll('[id^="edit-form-"]').forEach(form => {
    const addressId = form.id.replace('edit-form-', '');
    setupPincodeField(
      `AddressZip_${addressId}`,
      `AddressCity_${addressId}`,
      `AddressProvince_${addressId}`,
      null
    );
  });

  // Re-setup Save As option handlers
  document.querySelectorAll('.save-as-option').forEach(option => {
    option.addEventListener('click', function() {
      const radio = this.querySelector('input[type="radio"]');
      const container = this.closest('.save-as-options');

      container.querySelectorAll('.save-as-option').forEach(opt => {
        opt.classList.remove('active');
      });

      this.classList.add('active');

      if (radio) {
        radio.checked = true;
      }
    });
  });
}

function openEditAddressModal(addressId) {
  console.log('Opening edit modal for address:', addressId);

  const editForm = document.getElementById(`edit-form-${addressId}`);
  const editModal = document.getElementById('edit-address-modal');
  const saveAddressContainer = document.querySelector('.saved-addresses-container');

  if (saveAddressContainer) {
    saveAddressContainer.style.display = "none";
  }

  if (editModal && editForm) {
    // Hide all edit forms
    document.querySelectorAll('.edit-address-form').forEach(form => {
      form.style.display = 'none';
      form.classList.remove('active');
    });

    // Show selected form
    editForm.style.display = 'block';
    editForm.classList.add('active');

    currentEditAddressId = addressId;
    editModal.style.display = 'flex';

    // CRITICAL: Reinitialize with proper delay
    setTimeout(() => {
      // First, capture initial values
      if (typeof initializeEditForm === 'function') { initializeEditForm(addressId); } else { console.warn('initializeEditForm is not available'); }

      // Then setup listeners
      window.setupEditFormListeners(addressId);

      // Finally, update button state
      setTimeout(() => {
        updateEditButtonState(addressId);
      }, 50);
    }, 100);
  } else {
    console.error('Could not find edit modal or form for address:', addressId);
    alert('Error: Could not open edit form. Please refresh the page and try again.');
  }
}



document.addEventListener('DOMContentLoaded', function() {
  // Initialize all set default buttons on initial page load
  document.querySelectorAll('.default-btn').forEach(btn => {
    btn.onclick = async function(e) {
      e.preventDefault();
      e.stopPropagation();
      const addressCard = this.closest('.address-card');
      const addressId = addressCard.getAttribute('data-address-id');
      await setAsDefault(addressId);
    };
  });
});
// ============================================
// PINCODE API INTEGRATION
// ============================================

// Pincode lookup function
async function lookupPincode(pincode, cityFieldId, stateFieldId, countryFieldId) {
  try {
    // Show loading state
    const cityField = document.getElementById(cityFieldId);
    const stateField = document.getElementById(stateFieldId);


    // Make API call
    const response = await fetch(`https://api.postalpincode.in/pincode/${pincode}`);
    const data = await response.json();

    // Check if data is valid
    if (data && data[0] && data[0].Status === 'Success' && data[0].PostOffice && data[0].PostOffice.length > 0) {
      const postOffice = data[0].PostOffice[0];

      // Fill the fields
      if (cityField) {
        cityField.value = postOffice.District || postOffice.Block || '';
        cityField.disabled = true;
        cityField.style.backgroundColor = '#f5f5f5';
        cityField.style.cursor = 'not-allowed';
      }

      if (stateField) {
        stateField.value = postOffice.State || '';
        stateField.disabled = true;
        stateField.style.backgroundColor = '#f5f5f5';
        stateField.style.cursor = 'not-allowed';
      }

      // Country is already set to India in hidden field, but if you have a visible field:
      if (countryFieldId) {
        const countryField = document.getElementById(countryFieldId);
        if (countryField) {
          countryField.value = postOffice.Country || 'India';
          countryField.disabled = true;
          countryField.style.backgroundColor = '#f5f5f5';
          countryField.style.cursor = 'not-allowed';
        }
      }

      return true;
    } else {
      // Invalid pincode
      if (cityField) {
        cityField.value = '';
        cityField.disabled = false;
        cityField.style.backgroundColor = '';
        cityField.style.cursor = '';
      }
      if (stateField) {
        stateField.value = '';
        stateField.disabled = false;
        stateField.style.backgroundColor = '';
        stateField.style.cursor = '';
      }

      // Show error message
      showPincodeError(pincode.replace(/[^0-9]/g, ''), 'Invalid pincode. Please enter a valid pincode.');
      return false;
    }
  } catch (error) {
    console.error('Error fetching pincode data:', error);

    // Re-enable fields on error
    const cityField = document.getElementById(cityFieldId);
    const stateField = document.getElementById(stateFieldId);

    if (cityField) {
      cityField.value = '';
      cityField.disabled = false;
      cityField.style.backgroundColor = '';
      cityField.style.cursor = '';
    }
    if (stateField) {
      stateField.value = '';
      stateField.disabled = false;
      stateField.style.backgroundColor = '';
      stateField.style.cursor = '';
    }

    return false;
  }
}

// Show pincode-specific error
function showPincodeError(pincodeFieldId, message) {
  const errorDiv = document.getElementById(`error-${pincodeFieldId}`);
  if (errorDiv) {
    errorDiv.textContent = message;
    errorDiv.style.display = 'block';
  }
}

// Clear dependent fields when pincode is cleared
function clearDependentFields(cityFieldId, stateFieldId, countryFieldId) {
  const cityField = document.getElementById(cityFieldId);
  const stateField = document.getElementById(stateFieldId);
  const countryField = countryFieldId ? document.getElementById(countryFieldId) : null;

  if (cityField) {
    cityField.value = '';
    cityField.disabled = false;
    cityField.style.backgroundColor = '';
    cityField.style.cursor = '';
  }

  if (stateField) {
    stateField.value = '';
    stateField.disabled = false;
    stateField.style.backgroundColor = '';
    stateField.style.cursor = '';
  }

  if (countryField) {
    countryField.value = '';
    countryField.disabled = false;
    countryField.style.backgroundColor = '';
    countryField.style.cursor = '';
  }
}

// Setup pincode field with API integration
function setupPincodeField(pincodeFieldId, cityFieldId, stateFieldId, countryFieldId) {
  const pincodeField = document.getElementById(pincodeFieldId);
  if (!pincodeField) return;

  let debounceTimer;

  pincodeField.addEventListener('input', function() {
    const pincode = this.value.replace(/[^0-9]/g, ''); // Only allow numbers
    this.value = pincode; // Update field with cleaned value

    // Clear previous timer
    clearTimeout(debounceTimer);

    // Clear dependent fields if pincode is empty or invalid length
    if (pincode.length === 0) {
      clearDependentFields(cityFieldId, stateFieldId, countryFieldId);
      hideAddressError(pincodeFieldId);
      return;
    }

    // If pincode is 6 digits, fetch data
    if (pincode.length === 6) {
      // Debounce the API call
      debounceTimer = setTimeout(() => {
        lookupPincode(pincode, cityFieldId, stateFieldId, countryFieldId);
      }, 500); // Wait 500ms after user stops typing
    } else if (pincode.length > 6) {
      // Limit to 6 digits
      this.value = pincode.substring(0, 6);
    } else {
      // Clear fields if less than 6 digits
      clearDependentFields(cityFieldId, stateFieldId, countryFieldId);
    }
  });

  // Also trigger on blur
  pincodeField.addEventListener('blur', function() {
    const pincode = this.value.replace(/[^0-9]/g, '');
    if (pincode.length === 6) {
      lookupPincode(pincode, cityFieldId, stateFieldId, countryFieldId);
    }
  });
}

// Initialize pincode fields on page load
document.addEventListener('DOMContentLoaded', function() {

  // Setup for Add Address Modal
  setupPincodeField(
    'AddressZipNew',      // Pincode field
    'AddressCityNew',     // City field
    'AddressProvinceNew', // State field
    null                  // Country field (using hidden field)
  );

  // Setup for Edit Address Modals
  // We need to setup for all edit forms
  document.querySelectorAll('[id^="edit-form-"]').forEach(form => {
    const addressId = form.id.replace('edit-form-', '');
    setupPincodeField(
      `AddressZip_${addressId}`,      // Pincode field
      `AddressCity_${addressId}`,     // City field
      `AddressProvince_${addressId}`, // State field
      null                             // Country field (using hidden field)
    );
  });
});

// Update the openEditAddressModal to reinitialize pincode field
const originalOpenEdit = window.openEditAddressModal;
window.openEditAddressModal = function(addressId) {
  if (originalOpenEdit) {
    originalOpenEdit(addressId);
  }

  // Setup pincode field for this specific form
  setTimeout(() => {
    setupPincodeField(
      `AddressZip_${addressId}`,
      `AddressCity_${addressId}`,
      `AddressProvince_${addressId}`,
      null
    );
  }, 100);
};
  function clearOtherVal(){
    
    let inpValue = document.querySelector('.addinputForOther')
    inpValue.value = "";

  }
 (function() {
  const ADDRESSES_PER_PAGE_MOBILE = 3;
  let currentAddressesShown = ADDRESSES_PER_PAGE_MOBILE;

  function sortAddressesByDefault() {
    const addressesGrid = document.querySelector('.addresses-grid');
    if (!addressesGrid) return;

    const addressCards = Array.from(addressesGrid.querySelectorAll('.address-card:not(.add-new-card)'));
    const addNewCard = addressesGrid.querySelector('.add-new-card');
    const paginationDiv = addressesGrid.querySelector('.view-more-address-pgn');

    if (addressCards.length === 0) return;

    // Sort default address first
    addressCards.sort((a, b) => {
      const aIsDefault = a.classList.contains('default-add');
      const bIsDefault = b.classList.contains('default-add');
      if (aIsDefault && !bIsDefault) return -1;
      if (!aIsDefault && bIsDefault) return 1;
      return 0;
    });

    // Re-append in correct order
    addressesGrid.innerHTML = '';
    addressCards.forEach(card => addressesGrid.appendChild(card));

    // Append pagination and add-new button at end
    if (paginationDiv) addressesGrid.appendChild(paginationDiv);
    if (addNewCard) addressesGrid.appendChild(addNewCard);
  }

  function initializeAddressPagination() {
    const addressesGrid = document.querySelector('.addresses-grid');
    if (!addressesGrid) return;

    const paginationDiv = addressesGrid.querySelector('.view-more-address-pgn');
    if (paginationDiv) paginationDiv.style.display = 'none';

    const isMobile = window.innerWidth <= 768;
    const allAddressCards = Array.from(addressesGrid.querySelectorAll('.address-card:not(.add-new-card)'));
    const totalAddresses = allAddressCards.length;

    if (!isMobile) {
      // Show all addresses on desktop
      allAddressCards.forEach(card => { card.style.display = 'block'; });
      if (paginationDiv) paginationDiv.style.display = 'none';
      return;
    }

    // Hide extra addresses on mobile
    allAddressCards.forEach((card, index) => {
      card.style.display = index < ADDRESSES_PER_PAGE_MOBILE ? 'block' : 'none';
    });

    currentAddressesShown = ADDRESSES_PER_PAGE_MOBILE;

    // If more addresses exist, show pagination
    if (totalAddresses > ADDRESSES_PER_PAGE_MOBILE && paginationDiv) {
      paginationDiv.style.display = 'flex';

      // Remove any existing listener before re-adding
      paginationDiv.replaceWith(paginationDiv.cloneNode(true));
      const newPaginationDiv = addressesGrid.querySelector('.view-more-address-pgn');

      // Add click event
      newPaginationDiv.addEventListener('click', () => {
        const remainingAddresses = totalAddresses - currentAddressesShown;
        const addressesToShow = Math.min(ADDRESSES_PER_PAGE_MOBILE, remainingAddresses);

        for (let i = currentAddressesShown; i < currentAddressesShown + addressesToShow; i++) {
          if (allAddressCards[i]) {
            allAddressCards[i].style.display = 'block';
            allAddressCards[i].style.opacity = '0';
            allAddressCards[i].style.transform = 'translateY(20px)';

            setTimeout(() => {
              allAddressCards[i].style.transition = 'opacity 0.3s ease, transform 0.3s ease';
              allAddressCards[i].style.opacity = '1';
              allAddressCards[i].style.transform = 'translateY(0)';
            }, 100);
          }
        }

        currentAddressesShown += addressesToShow;

        if (currentAddressesShown >= totalAddresses) {
          newPaginationDiv.style.display = 'none';
        }
      });
    }
  }

  function resetPagination() {
    currentAddressesShown = ADDRESSES_PER_PAGE_MOBILE;
    initializeAddressPagination();
  }

  function initAll() {
    sortAddressesByDefault();
    initializeAddressPagination();
  }

  // Re-run on resize (to handle desktop/mobile switch)
  window.addEventListener('resize', resetPagination);

  // Initial run
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initAll);
  } else {
    initAll();
  }

  // Hook into Shopify reload/reinit functions
  const originalReload = window.reloadAddressesSection;
  window.reloadAddressesSection = async function() {
    if (originalReload) await originalReload();
    setTimeout(initAll, 400);
  };

  const originalReinit = window.reinitializeAddressElements;
  window.reinitializeAddressElements = function() {
    if (originalReinit) originalReinit();
    setTimeout(initAll, 100);
  };
})();

</script>
